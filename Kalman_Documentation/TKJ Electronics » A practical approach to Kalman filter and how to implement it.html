<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!-- saved from url=(0100)http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/ -->
<html xmlns="http://www.w3.org/1999/xhtml"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
	<link rel="shortcut icon" href="http://blog.tkjelectronics.dk/favicon.ico" type="image/x-icon">
	<link rel="icon" href="http://blog.tkjelectronics.dk/favicon.ico" type="image/x-icon">

	<title>TKJ Electronics » A practical approach to Kalman filter and how to implement it</title>
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0 - all posts" href="http://blog.tkjelectronics.dk/feed/">
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0 - all comments" href="http://blog.tkjelectronics.dk/comments/feed/">
	<link rel="pingback" href="http://blog.tkjelectronics.dk/xmlrpc.php">

	<!-- style START -->
	<!-- default style -->
	<style type="text/css" media="screen">@import url( http://blog.tkjelectronics.dk/wp-content/themes/inove/style.css );</style>
	<!-- for translations -->
		<!--[if IE]>
		<link rel="stylesheet" href="http://blog.tkjelectronics.dk/wp-content/themes/inove/ie.css" type="text/css" media="screen" />
	<![endif]-->
	<!-- style END -->

	<!-- script START -->
	<script type="text/javascript" async="" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/ga.js"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/base.js"></script>
	<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/menu.js"></script>
	<!-- script END -->

	<link rel="alternate" type="application/rss+xml" title="TKJ Electronics » A practical approach to Kalman filter and how to implement it Comments Feed" href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/feed/">
<link rel="stylesheet" id="nextgen_gallery_related_images-css" href="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/nextgen_gallery_related_images.css" type="text/css" media="all">
<link rel="stylesheet" id="codecolorer-css" href="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/codecolorer.css" type="text/css" media="screen">
<script type="text/javascript">
/* <![CDATA[ */
var photocrati_ajax = {"url":"http:\/\/blog.tkjelectronics.dk\/photocrati_ajax","wp_site_url":"http:\/\/blog.tkjelectronics.dk","wp_site_static_url":"http:\/\/blog.tkjelectronics.dk"};
/* ]]> */
</script>
<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/ajax.js"></script>
<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/jquery.js"></script>
<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/jquery-migrate.min.js"></script>
<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/persist.js"></script>
<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/store.js"></script>
<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/ngg_store.js"></script>
<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/lightbox_context.js"></script>
<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/external-tracking.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.tkjelectronics.dk/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.tkjelectronics.dk/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Raspberry Pi GPIO control" href="http://blog.tkjelectronics.dk/2012/09/raspberry-pi-gpio-control/">
<link rel="next" title="Cortex-M4 and 9DOF for $10" href="http://blog.tkjelectronics.dk/2012/09/cortex-m4-and-9dof-for-10/">
<meta name="generator" content="WordPress 3.9.1">
<link rel="canonical" href="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/TKJ Electronics » A practical approach to Kalman filter and how to implement it.html">
<link rel="shortlink" href="http://blog.tkjelectronics.dk/?p=2868">
<style type="text/css">.addtoany_subscribe img{border:0;}</style>

<!-- Bad Behavior 2.2.15 run time: 55.812 ms -->
<script type="text/javascript">
<!--
function bb2_addLoadEvent(func) {
	var oldonload = window.onload;
	if (typeof window.onload != 'function') {
		window.onload = func;
	} else {
		window.onload = function() {
			oldonload();
			func();
		}
	}
}

bb2_addLoadEvent(function() {
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1402807301 49.207.145.86';
			document.forms[i].appendChild(myElement);
		}
	}
});
// --></script>
		<!-- <meta name="NextGEN" version="2.0.66" /> -->
<link rel="stylesheet" type="text/css" href="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/recaptcha.css"><style type="text/css">
/* <![CDATA[ */
img.latex { vertical-align: middle; border: none; }
/* ]]> */
</style>
<!-- Google Analytics Tracking by Google Analyticator 6.4.7.3: http://www.videousermanuals.com/google-analyticator/ -->
<script type="text/javascript">
                var analyticsFileTypes = [''];
                            var analyticsSnippet = 'enabled';
                var analyticsEventTracking = 'enabled';
            </script>
<script type="text/javascript">
	var _gaq = _gaq || [];
  
	_gaq.push(['_setAccount', 'UA-25655064-4']);
    _gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
<style type="text/css"></style><script type="text/javascript" charset="UTF-8" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/jC3PGOmpHRpJ85b9_Rqy8YqnxkbHvo55azjJ8To545g.js"></script><style type="text/css">.a2a_menu, .a2a_menu *{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box;float:none;margin:0;padding:0;height:auto;width:auto;}.a2a_menu{width: 300px;}.a2a_menu table{border-collapse:collapse;border-spacing:0;width:auto}.a2a_menu table,.a2a_menu tbody,.a2a_menu td,.a2a_menu tr{border:0;margin:0;padding:0;background-color:#FFF} .a2a_menu td{vertical-align:top}.a2a_menu,.a2a_menu_inside{border-radius:16px;}.a2a_menu{display:none;z-index:9999999;position:absolute;direction:ltr;min-width:200px;background:#EEE;background:rgba(238,238,238,.6);font:12px Arial,Helvetica,sans-serif;color:#000;line-height:12px;border:1px solid transparent;_border:1px solid #EEE;padding:7px;vertical-align:baseline;overflow:hidden}.a2a_menu_inside{background-color:#FFF;border: 1px solid #CCC;padding:8px}.a2a_menu a span, .a2a_tabs .a2a_tab_selected span{color:#00F}.a2a_menu a:hover span, .a2a_tabs div span,.a2a_tabs a span{color:#000}.a2a_menu a,#a2a_hist_list a,.a2a_tabs div{color:#00F;text-decoration:none;font:12px Arial,Helvetica,sans-serif;line-height:12px;height:auto;width:auto;outline:none;-moz-outline:none;border-radius:8px;}.a2a_menu a:visited,#a2a_hist_list a:visited{color:#00F}.a2a_menu a:hover,.a2a_menu a:active,.a2a_menu a.a2a_i:focus,.a2a_tabs div:hover{color:#000;border:1px solid #CCC;background-color:#EEE;text-decoration:none}.a2a_menu span,.a2a_img{background:url(http://static.addtoany.com/menu/icons.26.png) no-repeat;border:0;display:block;line-height:16px}.a2a_menu span.a2a_i_find{height:16px;left:5px;position:absolute;top:2px;width:16px}#a2a_menu_container{display:inline-block} #a2a_menu_container{_display:inline} .a2a_menu_title_container{margin-bottom:2px;padding:6px}.a2a_menu_find_container{position:relative;text-align:left;margin:4px 1px;padding:1px 24px 1px 0;border:1px solid #CCC;border-radius:8px;}.a2a_cols_container{border-bottom-right-radius:8px;border-top-right-radius:8px}.a2a_cols_container .a2a_col1{overflow-x:hidden;overflow-y:auto;-webkit-overflow-scrolling:touch}.a2a_menu input, .a2a_menu input[type="text"]{display:block;background-image:none;box-shadow:none;line-height:100%;margin:0;overflow:hidden;padding:0;-moz-box-shadow:none;-webkit-box-shadow:none;-webkit-appearance:none} .a2a_menu_title_container input.a2a_menu_title{color:#000;background-color:#FFF;border:0;margin:0;padding:0;width:99%}.a2a_menu_find_container input.a2a_menu_find{position:relative;left:24px;color:#000;font-size:12px;padding:2px 0;outline:0;border:0;background-color:transparent;_background-color:#FFF;width:99%} .a2a_clear{clear:both} .a2a_img, .a2a_svg { display:block; overflow:hidden; }.a2a_img{height:16px;line-height:16px;width:16px;}.a2a_svg{height:32px;line-height:32px;width:32px;}.a2a_default_style a{float:left;line-height:16px;padding:0 2px}.a2a_default_style a:hover .a2a_img,.a2a_default_style a:hover .a2a_svg,.a2a_floating_style a:hover .a2a_img,.a2a_floating_style a:hover .a2a_svg { opacity: .7;}.a2a_default_style .a2a_svg, .a2a_floating_style .a2a_svg { border-radius:14% ;} .a2a_default_style .a2a_img, .a2a_default_style .a2a_dd, .a2a_default_style .a2a_svg{float:left}.a2a_default_style .a2a_img_text{margin-right:4px}.a2a_default_style .a2a_divider{border-left:1px solid #000;display:inline;float:left;height:16px;line-height:16px;margin:0 5px}.a2a_kit a{cursor:pointer}.a2a_floating_style { background-color: #fff; border-radius: 6px; padding: 4px; position: fixed; z-index: 9999998; }.a2a_vertical_style a { display: block; padding: 4px; }.a2a_floating_style.a2a_default_style { bottom: 0; }.a2a_floating_style.a2a_default_style a { padding: 4px; }.a2a_nowrap{white-space:nowrap}.a2a_note{margin:0 auto;padding:9px;font-size:12px;text-align:center}.a2a_note .a2a_note_note{margin:0;color:#000}.a2a_wide a{display:block;margin-top:3px;border:1px solid #EEE;padding:3px;text-align:center}.a2a_tabs{float:left;margin:0 0 3px} .a2a_tabs a,.a2a_tabs div{margin:1px;background-color:#EEE; border:1px solid #EEE; font-size:11px; padding:6px 12px ; white-space:nowrap} .a2a_tabs a span, .a2a_tabs div span{display:inline-block;padding-left:20px;height:auto;width:auto} .a2a_tabs_default a span, .a2a_tabs_default div span{height:auto;max-width:99px;overflow:hidden;padding-left:20px;width:auto;_width:expression(this.clientWidth > 99? "97px" : "auto");}.a2a_tabs a, .a2a_tabs a:visited, .a2a_tabs a:hover, .a2a_tabs div, .a2a_tabs div:hover{cursor:pointer;border-bottom:1px solid #EEE;color:#000;border-bottom-left-radius:0;-webkit-border-bottom-left-radius:0;-moz-border-radius-bottomleft:0;border-bottom-right-radius:0;-webkit-border-bottom-right-radius:0;-moz-border-radius-bottomright:0}a.a2a_tab_selected, a.a2a_tab_selected:visited,a.a2a_tab_selected:hover,a.a2a_tab_selected:active,a.a2a_tab_selected:focus, div.a2a_tab_selected,div.a2a_tab_selected:hover{color:#00F;background-color:#FFF;border:1px solid #CCC;border-bottom:1px solid #FFF}a.a2a_i{display:block;float:left;border:1px solid #FFF;padding:4px 6px;text-align:left;white-space:nowrap;width:126px;}a.a2a_i span{padding-left:20px}.a2a_x_shorten a.a2a_i{width:116px}a.a2a_sss{font-weight:700}a.a2a_ind{display:inline;margin:0;padding:0} a.a2a_email_client span{display:inline-block;height:16px;line-height:16px;margin:0 2px;padding-left:0;width:16px;}a.a2a_menu_show_more_less{margin:4px 0 8px;padding:0}a.a2a_menu_show_more_less span{display:inline-block;height:14px;margin:0 auto;vertical-align:baseline;width:16px} div.a2a_menu_powered_by{background-color:#EEE;font-size:9px;color:#999;text-align:center;margin-top:4px;padding:3px;border-radius:8px;}div.a2a_menu_powered_by a,div.a2a_menu_powered_by a:visited{display:inline;font-size:9px;color:#999}div.a2a_menu_powered_by a:hover{border:0;text-decoration:underline}iframe.a2a_shim{border:0;position:absolute;z-index:999999;}.a2a_dd img {border:0;-ms-touch-action:manipulation;}.a2a_i_a2a{background-position:0 0!important}.a2a_i_a2a_bw{background-position:0 -17px!important}.a2a_i_agregator{background-position:0 -34px!important}.a2a_i_aim{background-position:0 -51px!important}.a2a_i_allvoices{background-position:0 -68px!important}.a2a_i_amazon{background-position:0 -85px!important}.a2a_i_aol{background-position:0 -102px!important}.a2a_i_app_net{background-position:0 -119px!important}.a2a_i_apple_mail{background-position:0 -136px!important}.a2a_i_arto{background-position:0 -153px!important}.a2a_i_baidu{background-position:0 -170px!important}.a2a_i_bebo{background-position:0 -187px!important}.a2a_i_bibsonomy{background-position:0 -204px!important}.a2a_i_bitty{background-position:0 -221px!important}.a2a_i_blinklist{background-position:0 -238px!important}.a2a_i_blogger{background-position:0 -255px!important}.a2a_i_bloglines{background-position:0 -272px!important}.a2a_i_blogmarks{background-position:0 -289px!important}.a2a_i_bloomberg_current{background-position:0 -306px!important}.a2a_i_bookmark{background-position:0 -323px!important}.a2a_i_bookmarks_fr{background-position:0 -340px!important}.a2a_i_box{background-position:0 -357px!important}.a2a_i_buddymarks{background-position:0 -374px!important}.a2a_i_buffer{background-position:0 -391px!important}.a2a_i_care2{background-position:0 -408px!important}.a2a_i_chrome{background-position:0 -425px!important}.a2a_i_citeulike{background-position:0 -442px!important}.a2a_i_clear{background-position:0 -459px!important}.a2a_i_dailyrotation{background-position:0 -476px!important}.a2a_i_darr{background-position:0 -493px!important}.a2a_i_darr_wt{background-position:0 -510px!important}.a2a_i_default{background-position:0 -527px!important}.a2a_i_delicious{background-position:0 -544px!important}.a2a_i_designfloat{background-position:0 -561px!important}.a2a_i_diaspora{background-position:0 -578px!important}.a2a_i_digg{background-position:0 -595px!important}.a2a_i_diigo{background-position:0 -612px!important}.a2a_i_dzone{background-position:0 -629px!important}.a2a_i_email{background-position:0 -646px!important}.a2a_i_email_bw{background-position:0 -663px!important}.a2a_i_evernote{background-position:0 -680px!important}.a2a_i_facebook{background-position:0 -697px!important}.a2a_i_fark{background-position:0 -714px!important}.a2a_i_feed{background-position:0 -731px!important}.a2a_i_feedblitz{background-position:0 -748px!important}.a2a_i_feedbucket{background-position:0 -765px!important}.a2a_i_feedly{background-position:0 -782px!important}.a2a_i_feedmailer{background-position:0 -799px!important}.a2a_i_find{background-position:0 -816px!important}.a2a_i_fireant{background-position:0 -833px!important}.a2a_i_firefox{background-position:0 -850px!important}.a2a_i_flipboard{background-position:0 -867px!important}.a2a_i_folkd{background-position:0 -884px!important}.a2a_i_friendfeed{background-position:0 -901px!important}.a2a_i_funp{background-position:0 -918px!important}.a2a_i_gmail{background-position:0 -935px!important}.a2a_i_google{background-position:0 -952px!important}.a2a_i_google_plus{background-position:0 -969px!important}.a2a_i_hatena{background-position:0 -986px!important}.a2a_i_instapaper{background-position:0 -1003px!important}.a2a_i_itunes{background-position:0 -1020px!important}.a2a_i_jamespot{background-position:0 -1037px!important}.a2a_i_jumptags{background-position:0 -1054px!important}.a2a_i_khabbr{background-position:0 -1071px!important}.a2a_i_kindle{background-position:0 -1088px!important}.a2a_i_klipfolio{background-position:0 -1105px!important}.a2a_i_linkagogo{background-position:0 -1122px!important}.a2a_i_linkatopia{background-position:0 -1139px!important}.a2a_i_linkedin{background-position:0 -1156px!important}.a2a_i_livejournal{background-position:0 -1173px!important}.a2a_i_mail_ru{background-position:0 -1190px!important}.a2a_i_mendeley{background-position:0 -1207px!important}.a2a_i_meneame{background-position:0 -1224px!important}.a2a_i_miro{background-position:0 -1241px!important}.a2a_i_mister-wong{background-position:0 -1258px!important}.a2a_i_my_msn{background-position:0 -1275px!important}.a2a_i_myspace{background-position:0 -1292px!important}.a2a_i_netlog{background-position:0 -1309px!important}.a2a_i_netvibes{background-position:0 -1326px!important}.a2a_i_netvouz{background-position:0 -1343px!important}.a2a_i_newsalloy{background-position:0 -1360px!important}.a2a_i_newsisfree{background-position:0 -1377px!important}.a2a_i_newstrust{background-position:0 -1394px!important}.a2a_i_newsvine{background-position:0 -1411px!important}.a2a_i_nowpublic{background-position:0 -1428px!important}.a2a_i_odnoklassniki{background-position:0 -1445px!important}.a2a_i_oknotizie{background-position:0 -1462px!important}.a2a_i_oldreader{background-position:0 -1479px!important}.a2a_i_orkut{background-position:0 -1496px!important}.a2a_i_outlook{background-position:0 -1513px!important}.a2a_i_outlook_com{background-position:0 -1530px!important}.a2a_i_pdf{background-position:0 -1547px!important}.a2a_i_phonefavs{background-position:0 -1564px!important}.a2a_i_pinboard{background-position:0 -1581px!important}.a2a_i_pinterest{background-position:0 -1598px!important}.a2a_i_plurk{background-position:0 -1615px!important}.a2a_i_pocket{background-position:0 -1632px!important}.a2a_i_podnova{background-position:0 -1649px!important}.a2a_i_print{background-position:0 -1666px!important}.a2a_i_printfriendly{background-position:0 -1683px!important}.a2a_i_protopage{background-position:0 -1700px!important}.a2a_i_pusha{background-position:0 -1717px!important}.a2a_i_rapidfeeds{background-position:0 -1734px!important}.a2a_i_reddit{background-position:0 -1751px!important}.a2a_i_rediff{background-position:0 -1768px!important}.a2a_i_segnalo{background-position:0 -1785px!important}.a2a_i_share{background-position:0 -1802px!important}.a2a_i_sina_weibo{background-position:0 -1819px!important}.a2a_i_sitejot{background-position:0 -1836px!important}.a2a_i_slashdot{background-position:0 -1853px!important}.a2a_i_springpad{background-position:0 -1870px!important}.a2a_i_startaid{background-position:0 -1887px!important}.a2a_i_stumbleupon{background-position:0 -1904px!important}.a2a_i_stumpedia{background-position:0 -1921px!important}.a2a_i_symbaloo{background-position:0 -1938px!important}.a2a_i_technotizie{background-position:0 -1955px!important}.a2a_i_thefreedictionary{background-position:0 -1972px!important}.a2a_i_thefreelibrary{background-position:0 -1989px!important}.a2a_i_thunderbird{background-position:0 -2006px!important}.a2a_i_tuenti{background-position:0 -2023px!important}.a2a_i_tumblr{background-position:0 -2040px!important}.a2a_i_twiddla{background-position:0 -2057px!important}.a2a_i_twitter{background-position:0 -2074px!important}.a2a_i_typepad{background-position:0 -2091px!important}.a2a_i_uarr{background-position:0 -2108px!important}.a2a_i_uarr_wt{background-position:0 -2125px!important}.a2a_i_viadeo{background-position:0 -2142px!important}.a2a_i_vk{background-position:0 -2159px!important}.a2a_i_wanelo{background-position:0 -2176px!important}.a2a_i_webnews{background-position:0 -2193px!important}.a2a_i_whatsapp{background-position:0 -2210px!important}.a2a_i_windows_mail{background-position:0 -2227px!important}.a2a_i_winksite{background-position:0 -2244px!important}.a2a_i_wists{background-position:0 -2261px!important}.a2a_i_wordpress{background-position:0 -2278px!important}.a2a_i_xerpi{background-position:0 -2295px!important}.a2a_i_xing{background-position:0 -2312px!important}.a2a_i_yahoo{background-position:0 -2329px!important}.a2a_i_yigg{background-position:0 -2346px!important}.a2a_i_yim{background-position:0 -2363px!important}.a2a_i_yoolink{background-position:0 -2380px!important}.a2a_i_youmob{background-position:0 -2397px!important}</style><style type="text/css">.recaptchatable td img{display:block}.recaptchatable .recaptcha_r1_c1{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') 0 -63px no-repeat;width:318px;height:9px}.recaptchatable .recaptcha_r2_c1{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -18px 0 no-repeat;width:9px;height:57px}.recaptchatable .recaptcha_r2_c2{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -27px 0 no-repeat;width:9px;height:57px}.recaptchatable .recaptcha_r3_c1{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') 0 0 no-repeat;width:9px;height:63px}.recaptchatable .recaptcha_r3_c2{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -18px -57px no-repeat;width:300px;height:6px}.recaptchatable .recaptcha_r3_c3{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -9px 0 no-repeat;width:9px;height:63px}.recaptchatable .recaptcha_r4_c1{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -43px 0 no-repeat;width:171px;height:49px}.recaptchatable .recaptcha_r4_c2{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -36px 0 no-repeat;width:7px;height:57px}.recaptchatable .recaptcha_r4_c4{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -214px 0 no-repeat;width:97px;height:57px}.recaptchatable .recaptcha_r7_c1{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -43px -49px no-repeat;width:171px;height:8px}.recaptchatable .recaptcha_r8_c1{background:url('http://www.google.com/recaptcha/api/img/red/sprite.png') -43px -49px no-repeat;width:25px;height:8px}.recaptchatable .recaptcha_image_cell center img{height:57px}.recaptchatable .recaptcha_image_cell center{height:57px}.recaptchatable .recaptcha_image_cell{background-color:white;height:57px}#recaptcha_area,#recaptcha_table{width:318px!important}.recaptchatable,#recaptcha_area tr,#recaptcha_area td,#recaptcha_area th{margin:0!important;border:0!important;padding:0!important;border-collapse:collapse!important;vertical-align:middle!important}.recaptchatable *{margin:0;padding:0;border:0;font-family:helvetica,sans-serif;font-size:8pt;color:black;position:static;top:auto;left:auto;right:auto;bottom:auto}.recaptchatable #recaptcha_image{position:relative;margin:auto}.recaptchatable #recaptcha_image #recaptcha_challenge_image{display:block}.recaptchatable #recaptcha_image #recaptcha_ad_image{display:block;position:absolute;top:0}.recaptchatable img{border:0!important;margin:0!important;padding:0!important}.recaptchatable a,.recaptchatable a:hover{cursor:pointer;outline:none;border:0!important;padding:0!important;text-decoration:none;color:blue;background:none!important;font-weight:normal}.recaptcha_input_area{position:relative!important;width:153px!important;height:45px!important;margin-left:7px!important;margin-right:7px!important;background:none!important}.recaptchatable label.recaptcha_input_area_text{margin:0!important;padding:0!important;position:static!important;top:auto!important;left:auto!important;right:auto!important;bottom:auto!important;background:none!important;height:auto!important;width:auto!important}.recaptcha_theme_red label.recaptcha_input_area_text,.recaptcha_theme_white label.recaptcha_input_area_text{color:black!important}.recaptcha_theme_blackglass label.recaptcha_input_area_text{color:white!important}.recaptchatable #recaptcha_response_field{width:153px!important;position:relative!important;bottom:7px!important;padding:0!important;margin:15px 0 0 0!important;font-size:10pt}.recaptcha_theme_blackglass #recaptcha_response_field,.recaptcha_theme_white #recaptcha_response_field{border:1px solid gray}.recaptcha_theme_red #recaptcha_response_field{border:1px solid #cca940}.recaptcha_audio_cant_hear_link{font-size:7pt;color:black}.recaptchatable{line-height:1!important}#recaptcha_instructions_error{color:red!important}.recaptcha_only_if_privacy{float:right;text-align:right}#recaptcha-ad-choices{position:absolute;height:15px;top:0;right:0}#recaptcha-ad-choices img{height:15px}.recaptcha-ad-choices-collapsed{width:30px;height:15px;display:block}.recaptcha-ad-choices-expanded{width:75px;height:15px;display:none}#recaptcha-ad-choices:hover .recaptcha-ad-choices-collapsed{display:none}#recaptcha-ad-choices:hover .recaptcha-ad-choices-expanded{display:block}

.recaptcha_is_showing_audio .recaptcha_only_if_image,.recaptcha_isnot_showing_audio .recaptcha_only_if_audio,.recaptcha_had_incorrect_sol .recaptcha_only_if_no_incorrect_sol,.recaptcha_nothad_incorrect_sol .recaptcha_only_if_incorrect_sol{display:none !important}</style><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/reload"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/reload(1)"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/reload(2)"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/reload(3)"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/reload(4)"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/reload(5)"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/reload(6)"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/reload(7)"></script></head>


<body>
<!-- wrap START -->
<div id="wrap">

<!-- container START -->
<div id="container">

<!-- header START -->
<div id="header">

	<!-- banner START -->
		<!-- banner END -->

	<div id="caption">
		<h1 id="title"><a href="http://www.tkjelectronics.dk/">TKJ Electronics</a></h1>
		<div id="tagline">Development with ease</div>		
	</div>

	<a href="https://github.com/TKJElectronics" target="_blank"><img style="position: relative; top: -55px; float:right; margin: 0 0 15px 15px; border: 0;" height="100" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/forkus_github.png" alt="Fork us on GitHub"></a>

	<div class="fixed"></div>
</div>
<!-- header END -->

<!-- navigation START -->
<div id="navigation">
	<!-- menus START -->
	<ul id="menus">
		<li class="page_item"><a class="home" title="Home" href="http://blog.tkjelectronics.dk/">Home</a></li>
		<li><a class="page_item page-item-x5" href="http://blog.tkjelectronics.dk/category/reviews/">Reviews</a><ul style="visibility: hidden; display: block;"><li><a class="page_item page-item-x5 last" href="http://blog.tkjelectronics.dk/category/development-boards/">Development boards</a></li></ul></li>
		<li><a class="page_item page-item-x1" href="http://blog.tkjelectronics.dk/category/arduino/">Arduino</a></li>
		<li><a class="page_item page-item-x2" href="http://blog.tkjelectronics.dk/category/arm-projects/">ARM</a></li>
		<li><a class="page_item page-item-x4" href="http://blog.tkjelectronics.dk/category/pic/">PIC</a></li>
		<li><a class="page_item page-item-x5" href="http://blog.tkjelectronics.dk/category/fpga/">FPGA</a></li>
		<li><a class="page_item page-item-x5" href="http://blog.tkjelectronics.dk/category/tkjelectronics/">TKJ Electronics</a><ul style="visibility: hidden; display: block;"><li class="page_item page-item-581"><a href="http://blog.tkjelectronics.dk/donators/">Donators</a></li><li class="page_item page-item-2"><a href="http://blog.tkjelectronics.dk/about/" class=" last">About</a></li></ul></li>
		<li><a class="page_item page-item-x3" href="http://shop.tkjelectronics.dk/" target="_blank" style="font-weight: bold">Webshop</a></li>
		<li><a class="lastmenu" href="javascript:void(0);"></a></li>
	</ul>
	<!-- menus END -->

	<!-- searchbox START -->
	<div id="searchbox">
					<form action="http://blog.tkjelectronics.dk/" method="get">
				<div class="content">
					<input type="text" class="textfield searchtip" name="s" size="24" value="">
					<input type="submit" class="button" value="">
				</div>
			</form>
			</div>
<script type="text/javascript">
//<![CDATA[
	var searchbox = MGJS.$("searchbox");
	var searchtxt = MGJS.getElementsByClassName("textfield", "input", searchbox)[0];
	var searchbtn = MGJS.getElementsByClassName("button", "input", searchbox)[0];
	var tiptext = "Type text to search here...";
	if(searchtxt.value == "" || searchtxt.value == tiptext) {
		searchtxt.className += " searchtip";
		searchtxt.value = tiptext;
	}
	searchtxt.onfocus = function(e) {
		if(searchtxt.value == tiptext) {
			searchtxt.value = "";
			searchtxt.className = searchtxt.className.replace(" searchtip", "");
		}
	}
	searchtxt.onblur = function(e) {
		if(searchtxt.value == "") {
			searchtxt.className += " searchtip";
			searchtxt.value = tiptext;
		}
	}
	searchbtn.onclick = function(e) {
		if(searchtxt.value == "" || searchtxt.value == tiptext) {
			return false;
		}
	}
//]]>
</script>
	<!-- searchbox END -->

	<div class="fixed"></div>
</div>
<!-- navigation END -->

<!-- content START -->
<div id="content">

	<!-- main START -->
	<div id="main">


	<div id="postpath">
		<a title="Go to homepage" href="http://blog.tkjelectronics.dk/">Home</a>
		 &gt; <a href="http://blog.tkjelectronics.dk/category/guides/" title="View all posts in Guides" rel="category tag">Guides</a>, <a href="http://blog.tkjelectronics.dk/category/tkjelectronics/" title="View all posts in TKJ Electronics" rel="category tag">TKJ Electronics</a>		 &gt; A practical approach to Kalman filter and how to implement it	</div>

	<div class="post" id="post-2868">
		<h2>A practical approach to Kalman filter and how to implement it</h2>
		<div class="info">
			<span class="date">September 10th, 2012</span>
			<span class="author"><a href="http://blog.tkjelectronics.dk/author/lauszus/" title="Posts by Lauszus" rel="author">Lauszus</a></span>										<span class="addcomment"><a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#respond">Leave a comment</a></span>
				<span class="comments"><a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comments">Go to comments</a></span>
						<div class="fixed"></div>
		</div>
		<div class="content">
			<p>I have for a long time been interrested in Kalman filers and how they work, I also used a Kalman filter for my <a href="http://blog.tkjelectronics.dk/2012/03/the-balancing-robot/" target="_blank">Balancing robot</a>, but I never explained how it actually was implemented. Actually I had never taken the time to sit down with a pen and a piece of paper and try to do the math by myself, so I actually did not know how it was implemented.<br>
It turned out to be a good thing, as I actually discovered a mistake in the original code, but I will get back to that later.</p>
<p>I actually wrote about the Kalman filter as my master assignment in high school back in December 2011. But I only used the Kalman filter to calculate the true voltage of a DC signal modulated by known Gaussian white noise. My assignment can be found in the following zip file: <a href="http://www.tkjelectronics.dk/uploads/Kalman_SRP.zip">http://www.tkjelectronics.dk/uploads/Kalman_SRP.zip</a>. It is in danish, but you can properly use google translate to translate some of it. If you got any specific questions regarding the assignment, then ask in the comments below.</p>
<p>Okay, but back to the subject. As I sad I had never taken the time to sit down and do the math regarding the Kalman filter based on an accelerometer and a gyroscope. It was not as hard as I expected, but I must confess that I still have not studied the deeper theory behind, on why it actually works. But for me, and most people out there, I am more interrested in implementing the filter, than in the deeper theory behind and why the equations works.<br>
<span id="more-2868"></span><br>
Before we begin you must have some basic knowledge about matrices like multiplication of matrices and transposing of matrices. If not then please take a look at the following websites:</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/Matrix_multiplication#Matrix_product_.28two_matrices.29" target="_blank">http://en.wikipedia.org/wiki/Matrix_multiplication#Matrix_product_.28two_matrices.29</a></li>
<li><a href="http://www.mathwarehouse.com/algebra/matrix/multiply-matrix.php" target="_blank">http://www.mathwarehouse.com/algebra/matrix/multiply-matrix.php</a></li>
<li><a href="http://en.wikipedia.org/wiki/Transpose" target="_blank">http://en.wikipedia.org/wiki/Transpose</a></li>
<li><a href="http://en.wikipedia.org/wiki/Covariance_matrix" target="_blank">http://en.wikipedia.org/wiki/Covariance_matrix</a></li>
</ul>
<p>For those of you who do not know what a Kalman filter is, it is an algorithm which uses a series of measurements observed over time, in this context an accelerometer and a gyroscope. These measurements will contain noise that will contribute to the error of the measurement. The Kalman filter will then try to estimate the state of the system, based on the current and previous states, that tend to be more precise that than the measurements alone.</p>
<p>In this context the problem is that the accelerometer is in general very noise when it is used to measure the gravitational acceleration since the robot is moving back and forth. The problem with the gyro is that it drifts over time – just like a spinning wheel-gyro will start to fall down when it is losing speed.<br>
In short you can say that you can only trust the gyroscope on a short term while you can only trust the accelerometer on a long term. </p>
<p>There is actually a very easy way to deal with this by using a complimentary filter, which basicly just consist of a digital low-pass filter on the accelerometer and digital high-pass filter on the gyroscope readings. But it is not as accurate as the Kalman filter, but other people have succesfully build balancing robots using a fine-tuned complimentary filter.</p>
<p>More information about gyroscopes, accelerometer and complimentary filters can be found in this <a href="http://web.mit.edu/scolton/www/filter.pdf" target="_blank">pdf</a>. A comparison between a complimentary filter and a Kalman filter can be found in the following <a href="http://robottini.altervista.org/kalman-filter-vs-complementary-filter" target="_blank">blog post</a>.</p>
<p>The Kalman filter operates by producing a statistically optimal estimate of the system state based upon the measurement(s). To do this it will need to know the noise of the input to the filter called the measurement noise, but also the noise of the system itself called the process noise. To do this the noise has to be <a href="http://en.wikipedia.org/wiki/Normal_distribution" target="_blank">Gaussian distributed</a> and have a mean of zero, luckily for us most random noise have this characteristic.<br>
For more information about the theory behind the filter take a look at the following pages:</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/Kalman_filter" target="_blank">http://en.wikipedia.org/wiki/Kalman_filter</a></li>
<li><a href="http://www.cs.unc.edu/~welch/media/pdf/kalman_intro.pdf" target="_blank">http://www.cs.unc.edu/~welch/media/pdf/kalman_intro.pdf</a></li>
<li><a href="http://academic.csuohio.edu/simond/courses/eec644/kalman.pdf" target="_blank">http://academic.csuohio.edu/simond/courses/eec644/kalman.pdf</a></li>
</ul>
<p><strong>The system state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex.php" alt="\boldsymbol{x}_k" title="\boldsymbol{x}_k" class="latex"></strong><br>
The next of this article might seem very confusing for some, but I promise you if you grab a pen and a piece of paper and try to follow along it is not that hard if you are reasonable at math.</p>
<p>If you, like me, do not have a calculator or computer program that can work with matrices, then I recommend the free online calculator <a href="http://www.wolframalpha.com/" target="_blank">Wolfram Alpha</a>. I used it for all the calculations in this article.</p>
<p>I will use the same notation as the <a href="http://en.wikipedia.org/wiki/Kalman_filter" target="_blank">wikipedia article</a>, but I will like to note that when the matrixes are constants and does not depend on the current time you do not have to write the k after them. So for instance <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(1).php" alt="F_k" title="F_k" class="latex"> can be simplified to <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(2).php" alt="F" title="F" class="latex">.</p>
<p>Also I would like to write a small explanation of the other aspects of the notations.<br>
First I will make a note about whats called the <em>previous state</em>:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(3).php" alt="\boldsymbol{\hat{x}}_{k-1 | k-1}" title="\boldsymbol{\hat{x}}_{k-1 | k-1}" class="latex"></center><br>
Which is the previous estimated state based on the previous state and the estimates of the states before it.<p></p>
<p>The next is the <em>a priori state</em>:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(4).php" alt="\boldsymbol{\hat{x}}_{k | k-1}" title="\boldsymbol{\hat{x}}_{k | k-1}" class="latex"></center><br>
A priori means the estimate of the state matrix at the current time k based on the previous state of the system and the estimates of the states before it.<p></p>
<p>The last one is called <em>a posteriori state</em>:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(5).php" alt="\boldsymbol{\hat{x}}_{k | k}" title="\boldsymbol{\hat{x}}_{k | k}" class="latex"></center><br>
Is the estimated of the state at time k given observations up to and including at time k. <p></p>
<p>The problem is that the system state itself is hidden and can only be observed through observation <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(6).php" alt="z_k" title="z_k" class="latex">. This is also called a <a href="http://en.wikipedia.org/wiki/Hidden_Markov_model" target="_blank">Hidden Markov model</a>.</p>
<p>This means that the state will be based upon the state at time k and all the previous states. That also means that you can not trust the estimate of the state before the Kalman filter has stabilized – take a look at the graph at the front page of <a href="http://www.tkjelectronics.dk/uploads/Kalman_SRP.zip">my assignment</a>.</p>
<p>The hat over the <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(7).php" alt="\hat{x}" title="\hat{x}" class="latex"> means that is the estimate of the state. Unlike just a single <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(8).php" alt="x" title="x" class="latex"> which means the true state – the one we are trying to estimate.<br>
So the notation for the state at time k is:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(9).php" alt="\boldsymbol{x}_k " title="\boldsymbol{x}_k " class="latex"></center><p></p>
<p>The state of the system at time k if given by:</p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(10).php" alt="\boldsymbol{x}_k = \boldsymbol{F}x_{k-1} + \boldsymbol{B}u_k + w_k" title="\boldsymbol{x}_k = \boldsymbol{F}x_{k-1} + \boldsymbol{B}u_k + w_k" class="latex"></center><p></p>
<p>Where <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(11).php" alt="x_k" title="x_k" class="latex"> is the state matrix which is given by:</p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(12).php" alt="\boldsymbol{x}_k = \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_k" title="\boldsymbol{x}_k = \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_k" class="latex"></center><p></p>
<p>As you can see the output of the filter will be the angle <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(13).php" alt="\theta" title="\theta" class="latex"> but also the bias <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(14).php" alt="\dot{\theta}_b" title="\dot{\theta}_b" class="latex"> based upon the measurements from the accelerometer and gyroscope. The bias is the amount the gyro has drifted. This means that one can get the true rate by subtracting the bias from the gyro measurement.</p>
<p>The next is the <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(2).php" alt="F" title="F" class="latex"> matrix, which is the state transition model which is applied to the prevouis state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(15).php" alt="x_{k-1}" title="x_{k-1}" class="latex">.</p>
<p>In this case <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(2).php" alt="F" title="F" class="latex"> is defined as:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(16).php" alt="\boldsymbol{F} = \begin{bmatrix} 1 &amp; -\Delta t \\ 0 &amp; 1 \end{bmatrix}" title="\boldsymbol{F} = \begin{bmatrix} 1 &amp; -\Delta t \\ 0 &amp; 1 \end{bmatrix}" class="latex"></center><p></p>
<p>I know that the <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(17).php" alt="-\Delta t" title="-\Delta t" class="latex"> might seem confusing, but it will make sense later (take a look at my <a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/comment-page-1/#comment-57783">comment</a>).</p>
<p>The next is the control input <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(18).php" alt="u_k" title="u_k" class="latex">, in this case it is the gyroscope measurement in degrees per second (°/s) at time k, this is also called the rate <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(19).php" alt="\dot{\theta}" title="\dot{\theta}" class="latex">. We will actually rewrite the state equation as:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(20).php" alt="\boldsymbol{x}_k = \boldsymbol{F}x_{k-1} + \boldsymbol{B}{\dot{\theta}_k} + w_k" title="\boldsymbol{x}_k = \boldsymbol{F}x_{k-1} + \boldsymbol{B}{\dot{\theta}_k} + w_k" class="latex"></center><p></p>
<p>The next thing is the <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(21).php" alt="B" title="B" class="latex"> matrix. Which is called the control-input model, which is defined as:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(22).php" alt="\boldsymbol{B} = \begin{bmatrix} \Delta t \\ 0 \end{bmatrix}" title="\boldsymbol{B} = \begin{bmatrix} \Delta t \\ 0 \end{bmatrix}" class="latex"></center><p></p>
<p>This makes perfectly sense as you will get the angle <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(13).php" alt="\theta" title="\theta" class="latex"> when you multiply the rate <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(19).php" alt="\dot{\theta}" title="\dot{\theta}" class="latex"> by the delta time <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(23).php" alt="\Delta t" title="\Delta t" class="latex"> and since we can not calculate the bias directly based on the rate we will set the bottom of the matrix to 0.</p>
<p><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(24).php" alt="w_k" title="w_k" class="latex"> is process noise which is Gaussian distributed with a zero mean and with covariance <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(25).php" alt="Q" title="Q" class="latex"> to the time k:</p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(26).php" alt="\boldsymbol{w}_k \sim N\left ( 0, \boldsymbol{Q}_k \right )" title="\boldsymbol{w}_k \sim N\left ( 0, \boldsymbol{Q}_k \right )" class="latex"></center><p></p>
<p><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(27).php" alt="Q_k" title="Q_k" class="latex"> is the process noise covariance matrix and in this case the covariance matrix of the state estimate of the accelerometer and bias. In this case we will consider the estimate of the bias and the accelerometer to be independent, so it’s actually just equal to the variance of the estimate of the accelerometer and bias.<br>
The final matrix is defined as so:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(28).php" alt="\boldsymbol{Q}_k = \begin{bmatrix} Q_\theta &amp; 0 \\ 0 &amp; Q_{\dot{\theta}_b} \end{bmatrix}\Delta t " title="\boldsymbol{Q}_k = \begin{bmatrix} Q_\theta &amp; 0 \\ 0 &amp; Q_{\dot{\theta}_b} \end{bmatrix}\Delta t " class="latex"></center><p></p>
<p>As you can see the <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(27).php" alt="Q_k" title="Q_k" class="latex"> covariance matrix depends on the current time k, so the accelerometer variance <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(29).php" alt="Q_\theta" title="Q_\theta" class="latex"> and the variance of the bias <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(30).php" alt="Q_{\dot{\theta}_b}" title="Q_{\dot{\theta}_b}" class="latex"> is multiplied by the delta time <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(23).php" alt="\Delta t" title="\Delta t" class="latex">.<br>
This makes sense as the process noise will be larger as longer time it is since the last update of the state. For instance the gyro could have drifted.<br>
You will have to know these constants for the Kalman filter to work.<br>
Note if you set a larger value, the more noise in the estimation of the state. So for instance if the estimated angle starts to drift you have to increase the value of <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(30).php" alt="Q_{\dot{\theta}_b}" title="Q_{\dot{\theta}_b}" class="latex">. Otherwise if the estimate tends to be slow you are trusting the estimate of the angle too much and should try to decrease the value of <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(29).php" alt="Q_\theta" title="Q_\theta" class="latex"> to make it more responsive.</p>
<p><strong>The measurement <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(31).php" alt="\boldsymbol{z}_k" title="\boldsymbol{z}_k" class="latex"></strong><br>
Now we will take a look at the observation or measurement <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(6).php" alt="z_k" title="z_k" class="latex"> of the true state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(11).php" alt="x_k" title="x_k" class="latex">. The observation <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(6).php" alt="z_k" title="z_k" class="latex"> is given by:</p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(32).php" alt="\boldsymbol{z}_k = \boldsymbol{H}x_{k} + v_k" title="\boldsymbol{z}_k = \boldsymbol{H}x_{k} + v_k" class="latex"></center><p></p>
<p>As you can see the measurement <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(6).php" alt="z_k" title="z_k" class="latex"> is given by the current state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(11).php" alt="x_k" title="x_k" class="latex"> multiplied by the <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(33).php" alt="H" title="H" class="latex"> matrix plus the measurement noise <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(34).php" alt="v_k" title="v_k" class="latex">.</p>
<p><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(33).php" alt="H" title="H" class="latex"> is called the observation model and is used to map the true state space into the observed space. The true state can not be observed. Since the measurement is just the measurement from the accelerometer, <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(33).php" alt="H" title="H" class="latex"> is given by:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(35).php" alt="\boldsymbol{H} = \begin{bmatrix} 1 &amp; 0 \end{bmatrix}" title="\boldsymbol{H} = \begin{bmatrix} 1 &amp; 0 \end{bmatrix}" class="latex"></center><p></p>
<p>The noise of the measurement have to be Gaussian distributed as well with a zero mean and <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(36).php" alt="R" title="R" class="latex"> as the covariance:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(37).php" alt="\boldsymbol{v}_k \sim N\left ( 0, \boldsymbol{R} \right )" title="\boldsymbol{v}_k \sim N\left ( 0, \boldsymbol{R} \right )" class="latex"></center><p></p>
<p>But as <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(36).php" alt="R" title="R" class="latex"> is not a matrix the measurement noise is just equal to the variance of the measurement, since the covariance of the same variable is equal to the variance. See this <a href="http://en.wikipedia.org/wiki/Covariance_matrix#Generalization_of_the_variance" target="_blank">page</a> for more information.<br>
Now we can define <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(36).php" alt="R" title="R" class="latex"> as so: </p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(38).php" alt="\boldsymbol{R} = E \begin{bmatrix} v_k &amp; {v_k}^T \end{bmatrix} = var(v_k) " title="\boldsymbol{R} = E \begin{bmatrix} v_k &amp; {v_k}^T \end{bmatrix} = var(v_k) " class="latex"></center><p></p>
<p>More information about covariance can be found on <a href="http://en.wikipedia.org/wiki/Covariance_matrix#Conflicting_nomenclatures_and_notations" target="_blank">Wikipedia</a> and in <a href="http://www.tkjelectronics.dk/uploads/Kalman_SRP.zip">my assignment</a>.</p>
<p>We will assume that the measurement noise is the same and does not depend on the time k:</p><!--Ad Injection:random-->
<div style=""><center><script type="text/javascript"><!--
google_ad_client = "ca-pub-9105036627031912";
/* Blog, in posts 2 */
google_ad_slot = "2717457567";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></center></div>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(39).php" alt="var(v_k) = var(v) " title="var(v_k) = var(v) " class="latex"></center><p></p>
<p>Note that if you set the measurement noise variance <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(40).php" alt="var(v)" title="var(v)" class="latex"> too high the filter will respond really slowly as it is trusting new measurements less, but if it is too small the value might overshoot and be noisy since we trust the accelerometer measurements too much.</p>
<p>So to round up you have to find the the process noise variances <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(29).php" alt="Q_\theta" title="Q_\theta" class="latex"> and <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(30).php" alt="Q_{\dot{\theta}_b}" title="Q_{\dot{\theta}_b}" class="latex"> and the measurement variance of the measurement noise <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(40).php" alt="var(v)" title="var(v)" class="latex">. There are multiple ways to find them, but it is out of the aspect of this article.</p>
<p><strong>The Kalman filter equations</strong><br>
Okay now to the equations we will use to estimate the true state of the system at time k <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(41).php" alt="\hat{x}_k" title="\hat{x}_k" class="latex">. Some clever guys came up with equations found below to estimate the state of the system.<br>
The equations can be written more compact, but I prefer to have them stretched out, so it is easier to implement and understand the different steps.</p>
<p><strong>Predict</strong><br>
In the first two equations we will try to predict the current state and the error covariance matrix at time k. First the filter will try to estimate the current state based on all the previous states and the gyro measurement:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(42).php" alt="\boldsymbol{\hat{x}}_{k | k-1} = \boldsymbol{F}\hat{x}_{k-1 | k-1} + \boldsymbol{B}{\dot{\theta}_k} " title="\boldsymbol{\hat{x}}_{k | k-1} = \boldsymbol{F}\hat{x}_{k-1 | k-1} + \boldsymbol{B}{\dot{\theta}_k} " class="latex"></center><br>
That is also why it is called a control input, since we use it as an extra input to estimate the state at the current time k called the a priori state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(43).php" alt="\hat{x}_{k | k-1}" title="\hat{x}_{k | k-1}" class="latex"> as described in the beginning of the article.<p></p>
<p>The next thing is that we will try to estimate the a priori error covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(44).php" alt="P_{k | k-1}" title="P_{k | k-1}" class="latex"> based on the previous error covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(45).php" alt="P_{k-1 | k-1}" title="P_{k-1 | k-1}" class="latex">, which is defined as:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(46).php" alt="\boldsymbol{P}_{k | k-1} = \boldsymbol{F}\boldsymbol{P}_{k-1 | k-1}\boldsymbol{F}^T + \boldsymbol{Q}_k" title="\boldsymbol{P}_{k | k-1} = \boldsymbol{F}\boldsymbol{P}_{k-1 | k-1}\boldsymbol{F}^T + \boldsymbol{Q}_k" class="latex"></center><p></p>
<p>This matrix is used to estimate how much we trust the current values of the estimated state. The smaller the more we trust the current estimated state. The principle of the equation above is actually pretty easy to understand, as it is pretty obvious that the error covariance will increase since we last updated the estimate of the state, therefore we multiplied the error covariance matrix by the state transition model <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(2).php" alt="F" title="F" class="latex"> and the transpose of that <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(47).php" alt="F^T" title="F^T" class="latex"> and add the current process noise <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(27).php" alt="Q_k" title="Q_k" class="latex"> at time k.</p>
<p>The error covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(48).php" alt="P" title="P" class="latex"> in our case is a 2×2 matrix:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(49).php" alt="\boldsymbol{P} = \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}" title="\boldsymbol{P} = \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}" class="latex"></center><p></p>
<p><strong>Update</strong><br>
The fist thing we will do is to compute the difference between the measurement <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(6).php" alt="z_k" title="z_k" class="latex"> and the a priori state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(50).php" alt="x_{k | k-1}" title="x_{k | k-1}" class="latex">, this is also called the innovation:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(51).php" alt="\boldsymbol{\tilde{y}}_k = \boldsymbol{z}_k - \boldsymbol{H}\hat{x}_{k | k-1}" title="\boldsymbol{\tilde{y}}_k = \boldsymbol{z}_k - \boldsymbol{H}\hat{x}_{k | k-1}" class="latex"></center><p></p>
<p>The observation model <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(33).php" alt="H" title="H" class="latex"> is used to map the a priori state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(50).php" alt="x_{k | k-1}" title="x_{k | k-1}" class="latex"> into the observed space which is the measurement from the accelerometer, therefore the innovation is not a matrix<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(52).php" alt="\boldsymbol{\tilde{y}}_k = \begin{bmatrix} \boldsymbol{\tilde{y}} \end{bmatrix}_k" title="\boldsymbol{\tilde{y}}_k = \begin{bmatrix} \boldsymbol{\tilde{y}} \end{bmatrix}_k" class="latex"></center><p></p>
<p>The next thing we will do is calculate whats called the innovation covariance:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(53).php" alt="\boldsymbol{S}_k = \boldsymbol{H} \boldsymbol{P}_{k | k-1} \boldsymbol{H}^T + \boldsymbol{R} " title="\boldsymbol{S}_k = \boldsymbol{H} \boldsymbol{P}_{k | k-1} \boldsymbol{H}^T + \boldsymbol{R} " class="latex"></center><br>
What it does is that it tries to predict how much we should trust the measurement based on the a priori error covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(44).php" alt="P_{k | k-1}" title="P_{k | k-1}" class="latex"> and the measurement covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(36).php" alt="R" title="R" class="latex">. The observation model <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(33).php" alt="H" title="H" class="latex"> is used to map the a priori error covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(44).php" alt="P_{k | k-1}" title="P_{k | k-1}" class="latex"> into observed space.<p></p>
<p>The bigger the value of the measurement noise the larger the value of <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(54).php" alt="S" title="S" class="latex">, this means that we do not trust the incoming measurement that much.<br>
In this case <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(54).php" alt="S" title="S" class="latex"> is not a matrix and is just written as:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(55).php" alt="\boldsymbol{S}_k = \begin{bmatrix} \boldsymbol{S} \end{bmatrix}_k" title="\boldsymbol{S}_k = \begin{bmatrix} \boldsymbol{S} \end{bmatrix}_k" class="latex"></center><p></p>
<p>The next step is to calculate the Kalman gain. The Kalman gain is used to to indicate how much we trust the innovation and is defined as:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(56).php" alt="\boldsymbol{K}_k = \boldsymbol{P}_{k | k-1} \boldsymbol{H}^T \boldsymbol{S}_k^{-1} " title="\boldsymbol{K}_k = \boldsymbol{P}_{k | k-1} \boldsymbol{H}^T \boldsymbol{S}_k^{-1} " class="latex"></center><p></p>
<p>You can see that if we do not trust the innovation that much the innovation covariance <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(54).php" alt="S" title="S" class="latex"> will be high and if we trust the estimate of the state then the error covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(48).php" alt="P" title="P" class="latex"> will be small the Kalman gain will therefore be small and oppesite if we trust the innovation but does not trust the estimation of the current state.</p>
<p>If you take a deeper look you can see that the transpose of the observation model <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(33).php" alt="H" title="H" class="latex"> is used to map the state of the error covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(48).php" alt="P" title="P" class="latex"> into observed space. We then compare the error covariance matrix by multiplying with the inverse of the innovation covariance <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(54).php" alt="S" title="S" class="latex">.</p>
<p>This make sense as we will use the observation model <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(33).php" alt="H" title="H" class="latex"> to extract data from the state error covariance and compare that with the current estimate of the innovation covariance.</p>
<p>Note that if you do not know the state at startup you can set the error covariance matrix like so:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(57).php" alt="\boldsymbol{P} = \begin{bmatrix} L &amp; 0 \\ 0 &amp; L \end{bmatrix}" title="\boldsymbol{P} = \begin{bmatrix} L &amp; 0 \\ 0 &amp; L \end{bmatrix}" class="latex"></center><br>
Where <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(58).php" alt="L" title="L" class="latex"> represent a large number.<p></p>
<p>For my balancing robot I know the starting angle and I find the bias of the gyro at startup by calibrating, so I assume that the state will be known at startup, so I initialize the error covariance matrix like so:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(59).php" alt="\boldsymbol{P} = \begin{bmatrix} 0 &amp; 0 \\ 0 &amp; 0 \end{bmatrix}" title="\boldsymbol{P} = \begin{bmatrix} 0 &amp; 0 \\ 0 &amp; 0 \end{bmatrix}" class="latex"></center><p></p>
<p>Take a look at <a href="https://github.com/TKJElectronics/BalancingRobotArduino/blob/master/BalancingRobotArduino.ino#L448-L454" target="_blank">my calibration routine</a> for more information.</p>
<p>In this case the Kalman gain is a 2×1 matrix:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(60).php" alt="\boldsymbol{K} = \begin{bmatrix} K_0 \\ K_1 \end{bmatrix}" title="\boldsymbol{K} = \begin{bmatrix} K_0 \\ K_1 \end{bmatrix}" class="latex"></center><p></p>
<p>Now we can update the a posteriori estimate of the current state:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(61).php" alt="\boldsymbol{\hat{x}}_{k | k} = \boldsymbol{\hat{x}}_{k | k-1} + \boldsymbol{K}_k \; \boldsymbol{\tilde{y}}_k " title="\boldsymbol{\hat{x}}_{k | k} = \boldsymbol{\hat{x}}_{k | k-1} + \boldsymbol{K}_k \; \boldsymbol{\tilde{y}}_k " class="latex"></center><br>
This is done by adding the a priori state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(43).php" alt="\hat{x}_{k | k-1}" title="\hat{x}_{k | k-1}" class="latex"> with the Kalman gain multiplied by the innovation <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(62).php" alt="\tilde{y}_k" title="\tilde{y}_k" class="latex">.<br>
Remember that the innovation <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(62).php" alt="\tilde{y}_k" title="\tilde{y}_k" class="latex"> is the difference between the measurement <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(6).php" alt="z_k" title="z_k" class="latex"> and the estimated priori state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(43).php" alt="\hat{x}_{k | k-1}" title="\hat{x}_{k | k-1}" class="latex">, so the innovation can both be positive and negative.<p></p>
<p>A little simplified the equation can be understood as we simply correct the estimate of the a priori state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(43).php" alt="\hat{x}_{k | k-1}" title="\hat{x}_{k | k-1}" class="latex">, that was calculated using the previous state and the gyro measurement, with the measurement – in this case the accelerometer.</p>
<p>The last thing we will do is update the a posteriori error covariance matrix:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(63).php" alt="\boldsymbol{P}_{k | k} = (\boldsymbol{I} - \boldsymbol{K}_k \boldsymbol{H}) \boldsymbol{P}_{k | k-1} " title="\boldsymbol{P}_{k | k} = (\boldsymbol{I} - \boldsymbol{K}_k \boldsymbol{H}) \boldsymbol{P}_{k | k-1} " class="latex"></center><p></p>
<p>Where <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(64).php" alt="I" title="I" class="latex"> is called the identity matrix and is defined as:<br>
</p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(65).php" alt="\boldsymbol{I} = \begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1 \end{bmatrix}" title="\boldsymbol{I} = \begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1 \end{bmatrix}" class="latex"></center><p></p>
<p>What the filter is doing is that it is basically self-correcting the error covariance matrix based on how much we corrected the estimate. This make sense as we corrected the state based the a priori error covariance matrix <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(44).php" alt="P_{k | k-1}" title="P_{k | k-1}" class="latex">, but also the innovation covariance <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(66).php" alt="S_k" title="S_k" class="latex">.</p>
<p><strong>Implementing the filter</strong><br>
In this section I will use the equation from above to implement the filter into a simple c++ code that can be used for <a href="http://youtu.be/N28C_JqVhGU" target="_blank">balancing robots</a>, <a href="http://blog.tkjelectronics.dk/2012/03/quadcopters-how-to-get-started/" target="_blank">quadcopters</a> and other applications where you need to compute the angle, bias or rate.</p>
<p>In case you want the code next to you, it can be found at github: <a href="https://github.com/TKJElectronics/KalmanFilter" target="_blank">https://github.com/TKJElectronics/KalmanFilter</a>.</p>
<p>I will simply write the equations at the top of each step and then simplify them after that I will write how it is can be done i C and finally I will link to calculations done in <a href="http://wolframalpha.com/" target="_blank">Wolfram Alpha</a> in the bottom of each step, as I used them to do the calculation.</p>
<p><strong id="step1">Step 1:</strong></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(42).php" alt="\boldsymbol{\hat{x}}_{k | k-1} = \boldsymbol{F}\hat{x}_{k-1 | k-1} + \boldsymbol{B}{\dot{\theta}_k} " title="\boldsymbol{\hat{x}}_{k | k-1} = \boldsymbol{F}\hat{x}_{k-1 | k-1} + \boldsymbol{B}{\dot{\theta}_k} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(67).php" alt="\begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k-1} = \begin{bmatrix} 1 &amp; -\Delta t \\ 0 &amp; 1 \end{bmatrix} \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k-1 | k-1} + \begin{bmatrix} \Delta t \\ 0 \end{bmatrix} \dot{\theta}_k " title="\begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k-1} = \begin{bmatrix} 1 &amp; -\Delta t \\ 0 &amp; 1 \end{bmatrix} \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k-1 | k-1} + \begin{bmatrix} \Delta t \\ 0 \end{bmatrix} \dot{\theta}_k " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(68).php" alt=" = \begin{bmatrix} \theta - \dot{\theta}_b \Delta t \\ \dot{\theta}_b \end{bmatrix}_{k-1 | k-1} + \begin{bmatrix} \Delta t \\ 0 \end{bmatrix} \dot{\theta}_k " title=" = \begin{bmatrix} \theta - \dot{\theta}_b \Delta t \\ \dot{\theta}_b \end{bmatrix}_{k-1 | k-1} + \begin{bmatrix} \Delta t \\ 0 \end{bmatrix} \dot{\theta}_k " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(69).php" alt=" = \begin{bmatrix} \theta - \dot{\theta}_b \Delta t + \dot{\theta} \Delta t \\ \dot{\theta}_b \end{bmatrix} " title=" = \begin{bmatrix} \theta - \dot{\theta}_b \Delta t + \dot{\theta} \Delta t \\ \dot{\theta}_b \end{bmatrix} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(70).php" alt=" = \begin{bmatrix} \theta + \Delta t (\dot{\theta} - \dot{\theta}_b) \\ \dot{\theta}_b \end{bmatrix} " title=" = \begin{bmatrix} \theta + \Delta t (\dot{\theta} - \dot{\theta}_b) \\ \dot{\theta}_b \end{bmatrix} " class="latex"></center><p></p>
<p>As you can see the a priori estimate of the angle is <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(71).php" alt="\hat{\theta}_{k | k-1}" title="\hat{\theta}_{k | k-1}" class="latex"> is equal to the estimate of the previous state <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(72).php" alt="\hat{\theta}_{k-1 | k-1}" title="\hat{\theta}_{k-1 | k-1}" class="latex"> plus the unbiased rate times the delta time <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(23).php" alt="\Delta t" title="\Delta t" class="latex">.<br>
Since we can not directly measure the bias the estimate of the a priori bias is just equal to the previous one.</p>
<p>This can be written in C like so:</p>
<div class="codecolorer-container c default" style="overflow:auto;white-space:nowrap;"><div class="c codecolorer">rate <span class="sy0">=</span> newRate <span class="sy0">-</span> bias<span class="sy0">;</span><br>
angle <span class="sy0">+=</span> dt <span class="sy0">*</span> rate<span class="sy0">;</span></div></div>
<p>Note that I calculate the unbiased rate, so it can be be used by the user as well.</p>
<p>Wolfram Alpha links:</p>
<ul>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7B1%2C-t%7D%2C%7B0%2C1%7D%7D*%7B%7Btheta%7D%2C%7Bb%7D%7D%2B%7B%7Bt%7D%2C%7B0%7D%7D*r" target="_blank">Eq. 1.1</a></li>
</ul>
<p><strong id="step2">Step 2:</strong></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(46).php" alt="\boldsymbol{P}_{k | k-1} = \boldsymbol{F}\boldsymbol{P}_{k-1 | k-1}\boldsymbol{F}^T + \boldsymbol{Q}_k" title="\boldsymbol{P}_{k | k-1} = \boldsymbol{F}\boldsymbol{P}_{k-1 | k-1}\boldsymbol{F}^T + \boldsymbol{Q}_k" class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(73).php" alt="\begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} = \begin{bmatrix} 1 &amp; -\Delta t \\ 0 &amp; 1 \end{bmatrix} \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k-1 | k-1} \begin{bmatrix} 1 &amp; 0 \\ -\Delta t &amp; 1 \end{bmatrix} + \begin{bmatrix} Q_\theta &amp; 0 \\ 0 &amp; Q_{\dot{\theta}_b} \end{bmatrix}\Delta t " title="\begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} = \begin{bmatrix} 1 &amp; -\Delta t \\ 0 &amp; 1 \end{bmatrix} \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k-1 | k-1} \begin{bmatrix} 1 &amp; 0 \\ -\Delta t &amp; 1 \end{bmatrix} + \begin{bmatrix} Q_\theta &amp; 0 \\ 0 &amp; Q_{\dot{\theta}_b} \end{bmatrix}\Delta t " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(74).php" alt="= \begin{bmatrix} P_{00} - \Delta t P_{10} &amp; P_{01} - \Delta t P_{11} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k-1 | k-1} \begin{bmatrix} 1 &amp; 0 \\ -\Delta t &amp; 1 \end{bmatrix} + \begin{bmatrix} Q_\theta &amp; 0 \\ 0 &amp; Q_{\dot{\theta}_b} \end{bmatrix}\Delta t " title="= \begin{bmatrix} P_{00} - \Delta t P_{10} &amp; P_{01} - \Delta t P_{11} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k-1 | k-1} \begin{bmatrix} 1 &amp; 0 \\ -\Delta t &amp; 1 \end{bmatrix} + \begin{bmatrix} Q_\theta &amp; 0 \\ 0 &amp; Q_{\dot{\theta}_b} \end{bmatrix}\Delta t " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(75).php" alt="= \begin{bmatrix} P_{00} -\Delta t P_{10} -\Delta t (P_{01} - \Delta t P_{11}) &amp; P_{01} -\Delta t P_{11} \\ P_{10} -\Delta t P_{11} &amp; P_{11} \end{bmatrix}_{k-1 | k-1} + \begin{bmatrix} Q_\theta &amp; 0 \\ 0 &amp; Q_{\dot{\theta}_b} \end{bmatrix}\Delta t " title="= \begin{bmatrix} P_{00} -\Delta t P_{10} -\Delta t (P_{01} - \Delta t P_{11}) &amp; P_{01} -\Delta t P_{11} \\ P_{10} -\Delta t P_{11} &amp; P_{11} \end{bmatrix}_{k-1 | k-1} + \begin{bmatrix} Q_\theta &amp; 0 \\ 0 &amp; Q_{\dot{\theta}_b} \end{bmatrix}\Delta t " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(76).php" alt="= \begin{bmatrix} P_{00} -\Delta t P_{10} -\Delta t (P_{01} - \Delta t P_{11}) + Q_\theta \Delta t &amp; P_{01} -\Delta t P_{11} \\ P_{10} -\Delta t P_{11} &amp; P_{11} + Q_{\dot{\theta}_b} \Delta t \end{bmatrix} " title="= \begin{bmatrix} P_{00} -\Delta t P_{10} -\Delta t (P_{01} - \Delta t P_{11}) + Q_\theta \Delta t &amp; P_{01} -\Delta t P_{11} \\ P_{10} -\Delta t P_{11} &amp; P_{11} + Q_{\dot{\theta}_b} \Delta t \end{bmatrix} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(77).php" alt="= \begin{bmatrix} P_{00} + \Delta t (\Delta t P_{11} - P_{01} - P_{10} + Q_\theta) &amp; P_{01} -\Delta t P_{11} \\ P_{10} -\Delta t P_{11} &amp; P_{11} + Q_{\dot{\theta}_b} \Delta t \end{bmatrix} " title="= \begin{bmatrix} P_{00} + \Delta t (\Delta t P_{11} - P_{01} - P_{10} + Q_\theta) &amp; P_{01} -\Delta t P_{11} \\ P_{10} -\Delta t P_{11} &amp; P_{11} + Q_{\dot{\theta}_b} \Delta t \end{bmatrix} " class="latex"></center><p></p>
<p>The equations above can be written in C like so:</p>
<div class="codecolorer-container c default" style="overflow:auto;white-space:nowrap;"><div class="c codecolorer">P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">+=</span> dt <span class="sy0">*</span> <span class="br0">(</span>dt<span class="sy0">*</span>P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">-</span> P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">-</span> P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">+</span> Q_angle<span class="br0">)</span><span class="sy0">;</span><br>
P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">-=</span> dt <span class="sy0">*</span> P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span><br>
P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">-=</span> dt <span class="sy0">*</span> P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span><br>
P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">+=</span> Q_gyroBias <span class="sy0">*</span> dt<span class="sy0">;</span></div></div>
<p>Note that this is the part of the code that there was an error in in the original code that I used.</p>
<p>Wolfram Alpha links:</p>
<ul>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7B1%2C-t%7D%2C%7B0%2C1%7D%7D%2A%7B%7BP_00%2CP_01%7D%2C%7BP_10%2CP_11%7D%7D" target="_blank">Eq. 2.1</a></li>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7BP_00-t*P_10%2CP_01-t*P_11%7D%2C%7BP_10%2CP_11%7D%7D*%7B%7B1%2C0%7D%2C%7B-t%2C1%7D%7D" target="_blank">Eq. 2.2</a></li>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7B1%2C-t%7D%2C%7B0%2C1%7D%7D*%7B%7BP_00%2CP_01%7D%2C%7BP_10%2CP_11%7D%7D*%7B%7B1%2C0%7D%2C%7B-t%2C1%7D%7D%2B%7B%7BQ_a%2C0%7D%2C%7B0%2CQ_b%7D%7D*t" target="_blank">Eq. 2.3</a></li>
<li><a href="http://www.wolframalpha.com/input/?i=P_0-t*P_10-t*%28P_1-t*P_11%29%2Bt*Q_1" target="_blank">Eq. 2.4</a></li>
</ul>
<p><strong>Step 3:</strong></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(51).php" alt="\boldsymbol{\tilde{y}}_k = \boldsymbol{z}_k - \boldsymbol{H}\hat{x}_{k | k-1}" title="\boldsymbol{\tilde{y}}_k = \boldsymbol{z}_k - \boldsymbol{H}\hat{x}_{k | k-1}" class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(78).php" alt="= \boldsymbol{z}_k - \begin{bmatrix} 1 &amp; 0 \end{bmatrix} \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k-1}" title="= \boldsymbol{z}_k - \begin{bmatrix} 1 &amp; 0 \end{bmatrix} \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k-1}" class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(79).php" alt="= \boldsymbol{z}_k - \theta_{k | k-1} " title="= \boldsymbol{z}_k - \theta_{k | k-1} " class="latex"></center><p></p>
<p>The innovation can be calculated in C like so:</p>
<div class="codecolorer-container c default" style="overflow:auto;white-space:nowrap;"><div class="c codecolorer">y <span class="sy0">=</span> newAngle <span class="sy0">-</span> angle<span class="sy0">;</span></div></div>
<p>Wolfram Alpha links:</p>
<ul>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7B1%2C0%7D%7D*%7B%7Ba%7D%2C%7Bb%7D%7D" target="_blank">Eq. 3.1</a></li>
</ul>
<p><strong>Step 4:</strong></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(53).php" alt="\boldsymbol{S}_k = \boldsymbol{H} \boldsymbol{P}_{k | k-1} \boldsymbol{H}^T + \boldsymbol{R} " title="\boldsymbol{S}_k = \boldsymbol{H} \boldsymbol{P}_{k | k-1} \boldsymbol{H}^T + \boldsymbol{R} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(80).php" alt="= \begin{bmatrix} 1 &amp; 0 \end{bmatrix} \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} \begin{bmatrix} 1 \\ 0 \end{bmatrix} + \boldsymbol{R} " title="= \begin{bmatrix} 1 &amp; 0 \end{bmatrix} \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} \begin{bmatrix} 1 \\ 0 \end{bmatrix} + \boldsymbol{R} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(81).php" alt="= {P_{00}}_{k | k-1} + \boldsymbol{R} " title="= {P_{00}}_{k | k-1} + \boldsymbol{R} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(82).php" alt="= {P_{00}}_{k | k-1} + var(v) " title="= {P_{00}}_{k | k-1} + var(v) " class="latex"></center><p></p>
<p>Again the C code is pretty simple:</p>
<div class="codecolorer-container c default" style="overflow:auto;white-space:nowrap;"><div class="c codecolorer">S <span class="sy0">=</span> P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">+</span> R_angle<span class="sy0">;</span></div></div>
<p>Wolfram Alpha links:</p>
<ul>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7B1%2C0%7D%7D*%7B%7BP_00%2CP_01%7D%2C%7BP_10%2CP_11%7D%7D*%7B%7B1%7D%2C%7B0%7D%7D" target="_blank">Eq. 4.1</a></li>
</ul>
<p><strong>Step 5:</strong></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(56).php" alt="\boldsymbol{K}_k = \boldsymbol{P}_{k | k-1} \boldsymbol{H}^T \boldsymbol{S}_k^{-1} " title="\boldsymbol{K}_k = \boldsymbol{P}_{k | k-1} \boldsymbol{H}^T \boldsymbol{S}_k^{-1} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(83).php" alt="\begin{bmatrix} K_0 \\ K_1 \end{bmatrix}_k = \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} \begin{bmatrix} 1 \\ 0 \end{bmatrix} \boldsymbol{S}_k^{-1} " title="\begin{bmatrix} K_0 \\ K_1 \end{bmatrix}_k = \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} \begin{bmatrix} 1 \\ 0 \end{bmatrix} \boldsymbol{S}_k^{-1} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(84).php" alt="= \begin{bmatrix} P_{00} \\ P_{10} \end{bmatrix}_{k | k-1} \boldsymbol{S}_k^{-1} " title="= \begin{bmatrix} P_{00} \\ P_{10} \end{bmatrix}_{k | k-1} \boldsymbol{S}_k^{-1} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(85).php" alt="= \dfrac{\begin{bmatrix} P_{00} \\ P_{10}\end{bmatrix}_{k | k-1}}{\boldsymbol{S}_k} " title="= \dfrac{\begin{bmatrix} P_{00} \\ P_{10}\end{bmatrix}_{k | k-1}}{\boldsymbol{S}_k} " class="latex"></center><p></p>
<p>Note that in other cases <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(54).php" alt="S" title="S" class="latex"> can be a matrix and you can not just simply divide <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(48).php" alt="P" title="P" class="latex"> by <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(54).php" alt="S" title="S" class="latex">. Instead you have to calculate the inverse of the matrix. See the following <a href="http://mathworld.wolfram.com/MatrixInverse.html" target="_blank">page</a> for more information on how to do so.</p>
<p>The C implementation looks like this:</p>
<div class="codecolorer-container c default" style="overflow:auto;white-space:nowrap;"><div class="c codecolorer">K<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">/</span> S<span class="sy0">;</span><br>
K<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">=</span> P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">/</span> S<span class="sy0">;</span></div></div>
<p>Wolfram Alpha links:</p>
<ul>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7BP_00%2CP_01%7D%2C%7BP_10%2CP_11%7D%7D*%7B%7B1%7D%2C%7B0%7D%7D" target="_blank">Eq. 5.1</a></li>
</ul>
<p><strong>Step 6:</strong></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(61).php" alt="\boldsymbol{\hat{x}}_{k | k} = \boldsymbol{\hat{x}}_{k | k-1} + \boldsymbol{K}_k \; \boldsymbol{\tilde{y}}_k " title="\boldsymbol{\hat{x}}_{k | k} = \boldsymbol{\hat{x}}_{k | k-1} + \boldsymbol{K}_k \; \boldsymbol{\tilde{y}}_k " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(86).php" alt="\begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k} = \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k-1} + \begin{bmatrix} K_0 \\ K_1 \end{bmatrix}_k \boldsymbol{\tilde{y}}_k " title="\begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k} = \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k-1} + \begin{bmatrix} K_0 \\ K_1 \end{bmatrix}_k \boldsymbol{\tilde{y}}_k " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(87).php" alt="= \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k-1} + \begin{bmatrix} K_0 \; \boldsymbol{\tilde{y}} \\ K_1 \; \boldsymbol{\tilde{y}} \end{bmatrix}_k " title="= \begin{bmatrix} \theta \\ \dot{\theta}_b \end{bmatrix}_{k | k-1} + \begin{bmatrix} K_0 \; \boldsymbol{\tilde{y}} \\ K_1 \; \boldsymbol{\tilde{y}} \end{bmatrix}_k " class="latex"></center><p></p>
<p>Yet again the equation end up pretty short, and can be written as so in C:</p>
<div class="codecolorer-container c default" style="overflow:auto;white-space:nowrap;"><div class="c codecolorer">angle <span class="sy0">+=</span> K<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">*</span> y<span class="sy0">;</span><br>
bias <span class="sy0">+=</span> K<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">*</span> y<span class="sy0">;</span></div></div>
<p><strong>Step 7:</strong></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(63).php" alt="\boldsymbol{P}_{k | k} = (\boldsymbol{I} - \boldsymbol{K}_k \boldsymbol{H}) \boldsymbol{P}_{k | k-1} " title="\boldsymbol{P}_{k | k} = (\boldsymbol{I} - \boldsymbol{K}_k \boldsymbol{H}) \boldsymbol{P}_{k | k-1} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(88).php" alt="\begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k} = \left(\begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1 \end{bmatrix} - \begin{bmatrix} K_0 \\ K_1 \end{bmatrix}_k \begin{bmatrix} 1 &amp; 0 \end{bmatrix}\right) \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} " title="\begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k} = \left(\begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1 \end{bmatrix} - \begin{bmatrix} K_0 \\ K_1 \end{bmatrix}_k \begin{bmatrix} 1 &amp; 0 \end{bmatrix}\right) \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(89).php" alt="= \left(\begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1 \end{bmatrix} - \begin{bmatrix} K_0 &amp; 0 \\ K_1 &amp; 0 \end{bmatrix}_k \right) \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} " title="= \left(\begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1 \end{bmatrix} - \begin{bmatrix} K_0 &amp; 0 \\ K_1 &amp; 0 \end{bmatrix}_k \right) \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} " class="latex"></center><p></p>
<p></p><center><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/latex(90).php" alt="= \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} - \begin{bmatrix} K_0 \; P_{00} &amp; K_0 \; P_{01} \\ K_1 \; P_{00} &amp; K_1 \; P_{01} \end{bmatrix} " title="= \begin{bmatrix} P_{00} &amp; P_{01} \\ P_{10} &amp; P_{11} \end{bmatrix}_{k | k-1} - \begin{bmatrix} K_0 \; P_{00} &amp; K_0 \; P_{01} \\ K_1 \; P_{00} &amp; K_1 \; P_{01} \end{bmatrix} " class="latex"></center><p></p>
<p>Remember that we decrease the error covariance matrix again, since the error of the estimate of the state has been decreased.<br>
The C code looks like this:</p>
<div class="codecolorer-container c default" style="overflow:auto;white-space:nowrap;"><div class="c codecolorer">P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">-=</span> K<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">*</span> P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">;</span><br>
P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">-=</span> K<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">*</span> P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span><br>
P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">-=</span> K<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">*</span> P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">;</span><br>
P<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">-=</span> K<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">*</span> P<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span></div></div>
<p>Wolfram Alpha links:</p>
<ul>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7BK_0%7D%2C%7BK_1%7D%7D*%7B%7B1%2C0%7D%7D" target="_blank">Eq. 7.1</a></li>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D*%7B%7BP_00%2CP_01%7D%2C%7BP_10%2CP_11%7D%7D" target="_blank">Eq. 7.2</a></li>
<li><a href="http://www.wolframalpha.com/input/?i=%7B%7BK_0%2C0%7D%2C%7BK_1%2C0%7D%7D*%7B%7BP_00%2CP_01%7D%2C%7BP_10%2CP_11%7D%7D" target="_blank">Eq. 7.3</a></li>
</ul>
<p>Note that I have found that the following variances works perfectly for most IMUs:</p>
<div class="codecolorer-container c default" style="overflow:auto;white-space:nowrap;"><div class="c codecolorer"><span class="kw4">const</span> <span class="kw4">double</span> Q_angle <span class="sy0">=</span> <span class="nu16">0.001</span><span class="sy0">;</span><br>
<span class="kw4">const</span> <span class="kw4">double</span> Q_gyroBias <span class="sy0">=</span> <span class="nu16">0.003</span><span class="sy0">;</span><br>
<span class="kw4">const</span> <span class="kw4">double</span> R_angle <span class="sy0">=</span> <span class="nu16">0.03</span><span class="sy0">;</span></div></div>
<p>Remember that it’s very important to set the target angle at startup if you need to use the output at startup. For more information, see the <a href="https://github.com/TKJElectronics/BalancingRobotArduino/blob/master/BalancingRobotArduino.ino#L448-L454" target="_blank">calibration routine for my balancing robot</a>.</p>
<p>In case you missed it here is the library I wrote a library that can be used by any microcontroller that supports floating math. The source code can be found at github: <a href="https://github.com/TKJElectronics/KalmanFilter" target="_blank">https://github.com/TKJElectronics/KalmanFilter</a>.</p>
<p>If you prefer a video explanation about the Kalman filter, I recommend the following video series: <a href="http://www.youtube.com/watch?v=FkCT_LV9Syk" target="_blank">http://www.youtube.com/watch?v=FkCT_LV9Syk</a>.</p>
<p>Note that you can not use the library if you need to represent something in a full 3D orientations, as euler angles suffer from what is called <a href="http://en.wikipedia.org/wiki/Gimbal_lock" target="_blank">Gimbal lock</a> you will need to use Quaternions to do that, but that is a whole nother story. For now take a look at the following <a href="http://www.x-io.co.uk/node/8#open_source_imu_and_ahrs_algorithms" target="_blank">page</a>.</p>
<p>This is all for know, I hope that you will find i helpfull, if you do or have any questions fell free to post a comment below – it supports <a href="http://en.wikibooks.org/wiki/LaTeX/Mathematics" target="_blank">LaTeX syntax</a> as well, if you need to write equations.<br>
If you spot any errors please let me know as well.</p>
<p><!--At request, I have now generated a pdf version of the article. The pdf can be found at the following <a href="http://blog.tkjelectronics.dk/wp-content/uploads/TKJ-Electronics-A-practical-approach-to-Kalman-filter-and-how-to-implement-it.pdf" target="_blank">link</a>.&#8211;></p>
<!--Ad Injection:bottom-->
</p><div style=""><center><script type="text/javascript"><!--
google_ad_client = "ca-pub-9105036627031912";
/* Blog, in posts 2 */
google_ad_slot = "2717457567";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></center></div>			<div class="fixed"></div>
		</div>
		<div class="under">
			<span class="categories">Categories: </span><span><a href="http://blog.tkjelectronics.dk/category/guides/" title="View all posts in Guides" rel="category tag">Guides</a>, <a href="http://blog.tkjelectronics.dk/category/tkjelectronics/" title="View all posts in TKJ Electronics" rel="category tag">TKJ Electronics</a></span>			<span class="tags">Tags: </span><span></span>		</div>
	</div>

	<!-- related posts START -->
		<!-- related posts END -->

	<script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/comment.js"></script>



<div id="comments">

<div id="cmtswitcher">
			<a id="commenttab" class="curtab" href="javascript:void(0);" onclick="MGJS.switchTab(&#39;thecomments,commentnavi&#39;, &#39;thetrackbacks&#39;, &#39;commenttab&#39;, &#39;curtab&#39;, &#39;trackbacktab&#39;, &#39;tab&#39;);">Comments (201)</a>
		<a id="trackbacktab" class="tab" href="javascript:void(0);" onclick="MGJS.switchTab(&#39;thetrackbacks&#39;, &#39;thecomments,commentnavi&#39;, &#39;trackbacktab&#39;, &#39;curtab&#39;, &#39;commenttab&#39;, &#39;tab&#39;);">Trackbacks (3)</a>
				<span class="addcomment"><a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#respond">Leave a comment</a></span>
				<span class="addtrackback"><a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/trackback/">Trackback</a></span>
		<div class="fixed"></div>
</div>

<div id="commentlist">
	<!-- comments START -->
	<ol id="thecomments">
		<li class="comment admincomment" id="comment-503723">
		<div class="author">
			<div class="pic">
				<img alt="" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/04aa3aec79f1845a03eeb74681b57204" class="avatar avatar-32 photo" height="32" width="32">			</div>
			<div class="name">
									<a id="commentauthor-503723" class="url" href="http://tkjelectronics.dk/" rel="external nofollow">
				
				Lauszus
									</a>
							</div>
		</div>

		<div class="info">
			<div class="date">
				June 11th, 2014 at 16:35					 | <a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comment-503723">#1</a>
			</div>
			<div class="act">
				<a href="javascript:void(0);" onclick="MGJS_CMT.reply(&#39;commentauthor-503723&#39;, &#39;comment-503723&#39;, &#39;comment&#39;);">Reply</a> | 
				<a href="javascript:void(0);" onclick="MGJS_CMT.quote(&#39;commentauthor-503723&#39;, &#39;comment-503723&#39;, &#39;commentbody-503723&#39;, &#39;comment&#39;);">Quote</a>
							</div>
			<div class="fixed"></div>
			<div class="content">
				
				<div id="commentbody-503723">
					<p><a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comment-497787" rel="nofollow">@James </a><br>
1. Simply don’t add PI at these lines: <a href="https://github.com/TKJElectronics/Example-Sketch-for-IMU-including-Kalman-filter/blob/master/IMU/ITG3205_ADXL345/ITG3205_ADXL345.ino#L117" rel="nofollow">https://github.com/TKJElectronics/Example-Sketch-for-IMU-including-Kalman-filter/blob/master/IMU/ITG3205_ADXL345/ITG3205_ADXL345.ino#L117</a> and <a href="https://github.com/TKJElectronics/Example-Sketch-for-IMU-including-Kalman-filter/blob/master/IMU/ITG3205_ADXL345/ITG3205_ADXL345.ino#L123" rel="nofollow">https://github.com/TKJElectronics/Example-Sketch-for-IMU-including-Kalman-filter/blob/master/IMU/ITG3205_ADXL345/ITG3205_ADXL345.ino#L123</a>.<br>
2. Simply put it on one of it’s side. One of the axis should then read 1g while the others should read 0g. If they don’t this will be your zero value. Repeat this until you have this behavior on all three axis.</p>
<p><a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comment-497966" rel="nofollow">@faadhil </a><br>
1. Please read: <a href="http://arduino.cc/forum/index.php/topic,58048.0.html" rel="nofollow">http://arduino.cc/forum/index.php/topic,58048.0.html</a> where I have described what is going on.<br>
2. Because the gyro and accelerometer are not correctly orientated on the PCB, so you will have to compensate for this in the code.</p>
<p><a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comment-497992" rel="nofollow">@faadhil </a><br>
Please see the following example: <a href="https://github.com/TKJElectronics/Example-Sketch-for-IMU-including-Kalman-filter/tree/master/IMU/MPU6050_HMC5883L" rel="nofollow">https://github.com/TKJElectronics/Example-Sketch-for-IMU-including-Kalman-filter/tree/master/IMU/MPU6050_HMC5883L</a>.</p>
<p><a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comment-503552" rel="nofollow">@Jesse </a><br>
I am actually build one as well. I will write a blog post about once it is finished.<br>
The code is available here: <a href="https://github.com/Lauszus/BalancingRobotFullSize" rel="nofollow">https://github.com/Lauszus/BalancingRobotFullSize</a> and it is already balancing as we speak <img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/icon_wink.gif" alt=";)" class="wp-smiley"> </p>
				</div>
			</div>
		</div>
		<div class="fixed"></div>

</li><!-- #comment-## -->
	</ol>
	<!-- comments END -->

		<div id="commentnavi">
			<span class="pages">Comment pages</span>
			<div id="commentpager">
				<a class="prev page-numbers" href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/comment-page-4/#comments">« Previous</a>
<a class="page-numbers" href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/comment-page-1/#comments">1</a>
<span class="page-numbers dots">…</span>
<a class="page-numbers" href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/comment-page-3/#comments">3</a>
<a class="page-numbers" href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/comment-page-4/#comments">4</a>
<span class="page-numbers current">5</span>				<span id="cp_post_id">2868</span>
			</div>
			<div class="fixed"></div>
		</div>

	<!-- trackbacks START -->
			<ol id="thetrackbacks">
												<li class="trackback">
						<div class="date">
							September 10th, 2012 at 19:47							 | <a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comment-54236">#1</a>
						</div>
						<div class="act">
													</div>
						<div class="fixed"></div>
						<div class="title">
							<a href="http://5jcodelabs.com/howtomrj/kalman-filter-keeps-your-bot-balanced/">
								Belgaum news | About Belgaum | Belgaum information | Belgaum district | Belgaum city | Belgaum Hotels | Belgaum People | Belgaum tourism | Belgaum entertainment | Belgaum students | Inside facebook | Hack | make use of | technical news | | Kalman filter k							</a>
						</div>
					</li>
									<li class="trackback">
						<div class="date">
							September 11th, 2012 at 06:08							 | <a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comment-54770">#2</a>
						</div>
						<div class="act">
													</div>
						<div class="fixed"></div>
						<div class="title">
							<a href="http://waxnsuds.com/2012/09/11/kalman-filter-keeps-your-bot-balanced/">
								Kalman filter keeps your bot balanced | Cool Internet Projects							</a>
						</div>
					</li>
									<li class="trackback">
						<div class="date">
							September 12th, 2012 at 01:10							 | <a href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#comment-55523">#3</a>
						</div>
						<div class="act">
													</div>
						<div class="fixed"></div>
						<div class="title">
							<a href="http://www.dzime.com/index.php/kalman-filter-keeps-your-bot-balanced/">
								å¡å°”æ›¼æ»¤æ³¢å™¨ä¿æŒä½&nbsp;çš„botå¹³è¡¡ « ç”µå­è¿·							</a>
						</div>
					</li>
				
					</ol>
		<div class="fixed"></div>
	<!-- trackbacks END -->
</div>

</div>

	<form action="http://blog.tkjelectronics.dk/wp-comments-post.php" method="post" id="commentform">
	<div id="respond">

					
			<div id="author_info">
				<div class="row">
					<input type="text" name="author" id="author" class="textfield" value="" size="24" tabindex="1">
					<label for="author" class="small">Name (required)</label>
				</div>
				<div class="row">
					<input type="text" name="email" id="email" class="textfield" value="" size="24" tabindex="2">
					<label for="email" class="small">E-Mail (will not be published) (required)</label>
				</div>
				<div class="row">
					<input type="text" name="url" id="url" class="textfield" value="" size="24" tabindex="3">
					<label for="url" class="small">Website</label>
				</div>
			</div>

			
		
		<!-- comment input -->
		<div class="row">
			<textarea name="comment" id="comment" tabindex="4" rows="8" cols="50"></textarea>
		</div>

		<!-- comment submit and rss -->
		<div id="submitbox">
			<a class="feed" href="http://blog.tkjelectronics.dk/comments/feed/">Subscribe to comments feed</a>
			<div class="submitbutton">
				
			</div>
						<input type="hidden" name="comment_post_ID" value="2868">
			<div class="fixed"></div>
		</div>

	</div>
	<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="195c26b8ab"></p>                <script type="text/javascript">
                    var RecaptchaOptions = { theme : 'red', lang : 'en' , tabindex : 5 };
                </script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/challenge"></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/recaptcha.js"></script><div id="recaptcha_widget_div" class=" recaptcha_nothad_incorrect_sol recaptcha_isnot_showing_audio"><div id="recaptcha_area"><table id="recaptcha_table" class="recaptchatable recaptcha_theme_red"> <tbody><tr> <td colspan="6" class="recaptcha_r1_c1"></td> </tr> <tr> <td class="recaptcha_r2_c1"></td> <td colspan="4" class="recaptcha_image_cell"><center><div id="recaptcha_image" style="width: 300px; height: 57px;"><img id="recaptcha_challenge_image" alt="reCAPTCHA challenge image" height="57" width="300" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/image"></div></center></td> <td class="recaptcha_r2_c2"></td> </tr> <tr> <td rowspan="6" class="recaptcha_r3_c1"></td> <td colspan="4" class="recaptcha_r3_c2"></td> <td rowspan="6" class="recaptcha_r3_c3"></td> </tr> <tr> <td rowspan="3" class="recaptcha_r4_c1" height="49"> <div class="recaptcha_input_area"> <span id="recaptcha_challenge_field_holder" style="display: none;"><input type="hidden" name="recaptcha_challenge_field" id="recaptcha_challenge_field" value="03AHJ_VuuzrFeUxeh8iDAIzSkfnAK2WZACZyS44re8MEgDArbM4jNAQ2sue75P5S3UZaeVYhhSoEPvCC7KUbC8NuAmHK0FaFvNfQhSlVg_b_6HwX0vdIpoxiY8jReQNl8bKYYLIJkYhz6YJHmiBMIR5jf-r9obI_nNj0XdIrYbkUK3CtgeOH4-xUnH8R49O-xsUVTdChCEPOn_OnQmkZOw1uToXyXg2XqoXu28Nb29O4AKdb0LMEwtKn5wj6xhHNkaH5LHQUNKKzp_TM0eWKO29urzOp7JZgaX2Sbzl4OAM1Nya3cOL52eLm8"></span><input name="recaptcha_response_field" id="recaptcha_response_field" type="text" autocorrect="off" autocapitalize="off" placeholder="Type the text" autocomplete="off" tabindex="5"> <span id="recaptcha_privacy" class="recaptcha_only_if_privacy" tabindex="9"><a href="http://www.google.com/intl/en/policies/" target="_blank">Privacy &amp; Terms</a></span> </div> </td> <td rowspan="4" class="recaptcha_r4_c2"></td> <td><a id="recaptcha_reload_btn" title="Get a new challenge" tabindex="6"><img id="recaptcha_reload" width="25" height="17" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/refresh.gif" alt="Get a new challenge"></a></td> <td rowspan="4" class="recaptcha_r4_c4"></td> </tr> <tr> <td><a id="recaptcha_switch_audio_btn" class="recaptcha_only_if_image" title="Get an audio challenge" tabindex="7"><img id="recaptcha_switch_audio" width="25" height="16" alt="Get an audio challenge" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/audio.gif"></a><a id="recaptcha_switch_img_btn" class="recaptcha_only_if_audio" title="Get a visual challenge" tabindex="8"><img id="recaptcha_switch_img" width="25" height="16" alt="Get a visual challenge" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/text.gif"></a></td> </tr> <tr> <td><a id="recaptcha_whatsthis_btn" title="Help" tabindex="9"><img id="recaptcha_whatsthis" width="25" height="16" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/help.gif" alt="Help"></a></td> </tr> <tr> <td class="recaptcha_r7_c1"></td> <td class="recaptcha_r8_c1"></td> </tr> </tbody></table> </div></div>

	<noscript>
  		&lt;iframe src="http://www.google.com/recaptcha/api/noscript?k=6Lc5Gb0SAAAAAHioV68AuI-l11dIb9jAB5h8P_3W" height="300" width="500" frameborder="0"&gt;&lt;/iframe&gt;&lt;br/&gt;
  		&lt;textarea name="recaptcha_challenge_field" rows="3" cols="40"&gt;&lt;/textarea&gt;
  		&lt;input type="hidden" name="recaptcha_response_field" value="manual_challenge"/&gt;
	</noscript>                        <div id="recaptcha-submit-btn-area">&nbsp;<input name="submit" type="submit" id="submit" class="button" tabindex="6" value="Submit Comment"></div>
                        <noscript>
                         &lt;style type='text/css'&gt;#submit {display:none;}&lt;/style&gt;
                         &lt;input name="submit" type="submit" id="submit-alt" tabindex="6" value="Submit Comment"/&gt; 
                        </noscript><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/form.js"></script>
<p style="display: none;"></p>	<input type="hidden" id="ak_js" name="ak_js" value="1402807307022"><input type="hidden" name="bb2_screener_" value="1402807301 49.207.145.86"></form>

	

	<div id="postnavi">
		<span class="prev"><a href="http://blog.tkjelectronics.dk/2012/09/cortex-m4-and-9dof-for-10/" rel="next">Cortex-M4 and 9DOF for $10</a></span>
		<span class="next"><a href="http://blog.tkjelectronics.dk/2012/09/raspberry-pi-gpio-control/" rel="prev">Raspberry Pi GPIO control</a></span>
		<div class="fixed"></div>
	</div>


	</div>
	<!-- main END -->

	
<!-- sidebar START -->
<div id="sidebar">

<!-- sidebar north START -->
<div id="northsidebar" class="sidebar">

<div align="center">
  <script type="text/javascript">
    <!--
    google_ad_client = "ca-pub-9105036627031912";
    /* Blog, right panel, top */
    google_ad_slot = "1424816654";
    google_ad_width = 234;
    google_ad_height = 60;
    //-->
  </script>
  <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>


	<!-- feeds -->
	<div class="widget widget_feeds">
		<div class="content">
			<div id="subscribe"><a rel="external nofollow" id="feedrss" title="Subscribe to this blog..." href="http://blog.tkjelectronics.dk/feed/"><abbr title="Really Simple Syndication">RSS</abbr></a></div>
						<div class="fixed"></div>
		</div>
	</div>

	<!-- showcase -->
	
<div id="paypal_donations-3" class="widget widget_paypal_donations"><!-- Begin PayPal Donations by http://johansteen.se/ -->
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
    <div class="paypal-donations">
        <input type="hidden" name="cmd" value="_donations">
        <input type="hidden" name="business" value="tkjpay@tkjelectronics.dk">
        <input type="hidden" name="item_name" value="Donation to TKJ Electronics">
        <input type="hidden" name="currency_code" value="USD">
        <input type="image" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/btn_donate_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online.">
        <img alt="" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/pixel.gif" width="1" height="1">
    </div>
<input type="hidden" name="bb2_screener_" value="1402807301 49.207.145.86"></form>
<!-- End PayPal Donations -->
</div>		<div id="recent-posts-3" class="widget widget_recent_entries">		<h3>Recent Posts</h3>		<ul>
					<li>
				<a href="http://blog.tkjelectronics.dk/2014/03/usb-host-shield-mini-in-webshop/">USB Host Shield Mini in webshop</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2014/02/stm32-nucleo/">STM32 Nucleo – a new mbed platform</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2014/01/new-contributor-at-tkj-electronics-diego/">New contributor at TKJ Electronics – Diego</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2014/01/color-object-tracking-with-stm32-ov7725/">Color object tracking with STM32 + OV7725</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2014/01/year-2013-thomas/">Year 2013 for Thomas</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2014/01/ps4-controller-now-supported-by-the-usb-host-library/">PS4 controller now supported by the USB Host library</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2013/12/bluetooth-hid-devices-now-supported-by-the-usb-host-library/">Bluetooth HID devices now supported by the USB Host library</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2013/06/how-to-stream-video-and-audio-from-a-raspberry-pi-with-no-latency/">How to stream video and audio from a Raspberry Pi with no latency</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2013/04/kickstarter-successfully-funded/">Kickstarter successfully funded</a>
						</li>
					<li>
				<a href="http://blog.tkjelectronics.dk/2013/04/balanduino-kickstarter-almost-finished/">Balanduino Kickstarter almost finished</a>
						</li>
				</ul>
		</div></div>
<!-- sidebar north END -->

<div id="centersidebar">

	<!-- sidebar east START -->
	<div id="eastsidebar" class="sidebar">
	
		<!-- categories -->
		<div class="widget widget_categories">
			<h3>Categories</h3>
			<ul>
					<li class="cat-item cat-item-12"><a href="http://blog.tkjelectronics.dk/category/arduino/" title="View all posts filed under Arduino">Arduino</a>
</li>
	<li class="cat-item cat-item-32"><a href="http://blog.tkjelectronics.dk/category/arm-projects/" title="View all posts filed under ARM">ARM</a>
</li>
	<li class="cat-item cat-item-72"><a href="http://blog.tkjelectronics.dk/category/balanduino/" title="View all posts filed under Balanduino">Balanduino</a>
</li>
	<li class="cat-item cat-item-70"><a href="http://blog.tkjelectronics.dk/category/bluetooth/" title="View all posts filed under Bluetooth">Bluetooth</a>
</li>
	<li class="cat-item cat-item-67"><a href="http://blog.tkjelectronics.dk/category/development-boards/" title="View all posts filed under Development boards">Development boards</a>
</li>
	<li class="cat-item cat-item-71"><a href="http://blog.tkjelectronics.dk/category/embedded-linux/" title="View all posts filed under Embedded Linux">Embedded Linux</a>
</li>
	<li class="cat-item cat-item-57"><a href="http://blog.tkjelectronics.dk/category/fpga/" title="View all posts filed under FPGA">FPGA</a>
</li>
	<li class="cat-item cat-item-59"><a href="http://blog.tkjelectronics.dk/category/guides/" title="View all posts filed under Guides">Guides</a>
</li>
	<li class="cat-item cat-item-45"><a href="http://blog.tkjelectronics.dk/category/mini2440/" title="View all posts filed under mini2440">mini2440</a>
</li>
	<li class="cat-item cat-item-69"><a href="http://blog.tkjelectronics.dk/category/news/" title="View all posts filed under News">News</a>
</li>
	<li class="cat-item cat-item-68"><a href="http://blog.tkjelectronics.dk/category/other-microprocessors/" title="View all posts filed under Other Microprocessors">Other Microprocessors</a>
</li>
	<li class="cat-item cat-item-11"><a href="http://blog.tkjelectronics.dk/category/pic/" title="View all posts filed under PIC">PIC</a>
</li>
	<li class="cat-item cat-item-73"><a href="http://blog.tkjelectronics.dk/category/raspberry-pi/" title="View all posts filed under Raspberry Pi">Raspberry Pi</a>
</li>
	<li class="cat-item cat-item-58"><a href="http://blog.tkjelectronics.dk/category/reviews/" title="View all posts filed under Reviews">Reviews</a>
</li>
	<li class="cat-item cat-item-33"><a href="http://blog.tkjelectronics.dk/category/stm32/" title="View all posts filed under STM32">STM32</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://blog.tkjelectronics.dk/category/tkjelectronics/" title="View all posts filed under TKJ Electronics">TKJ Electronics</a>
</li>
	<li class="cat-item cat-item-61"><a href="http://blog.tkjelectronics.dk/category/tools/" title="View all posts filed under Tools">Tools</a>
</li>
	<li class="cat-item cat-item-38"><a href="http://blog.tkjelectronics.dk/category/usb/" title="View all posts filed under USB">USB</a>
</li>
			</ul>
		</div>

		</div>
	<!-- sidebar east END -->

	<!-- sidebar west START -->
	<div id="westsidebar" class="sidebar">
	
		<!-- blogroll -->
		<div class="widget widget_links">
			<h3>Blogroll</h3>
			<ul>
				<li><a href="http://www.circuitsathome.com/" target="_blank">Circuits@Home</a></li>
<li><a href="http://www.eevblog.com/" title="A great blog and videos about electronics" target="_blank">EEVblog</a></li>
<li><a href="http://www.eeweb.com/">EEWeb</a></li>
<li><a href="https://github.com/TKJElectronics" target="_blank">Github</a></li>
<li><a href="http://actpcb.com/pcb-calculator" title="Different kinds of calculators when designing electronics" target="_blank">PCB Calculators</a></li>
<li><a href="http://www.seeedstudio.com/" title="SeeedStudio Electronics shop with everything from Arduino to ARM kits" target="_blank">SeeedStudio</a></li>
<li><a href="http://www.twitter.com/tkjelectronics" title="Our Twitter account with news, upcoming products, pre-releases and other stuff" target="_blank">Twitter</a></li>
<li><a href="http://shop.tkjelectronics.dk/" target="_blank">Webshop</a></li>
<li><a href="http://www.youtube.com/mindthomas" title="Our Youtube account with different electronics-related videoes" target="_blank">Youtube</a></li>
			</ul>
		</div>

		</div>
	<!-- sidebar west END -->
	<div class="fixed"></div>
</div>

<!-- sidebar south START -->
<div id="southsidebar" class="sidebar">
<div id="add_to_any_subscribe_widget-3" class="widget widget_add_to_any_subscribe_widget">
		<a class="a2a_dd addtoany_subscribe" href="http://www.addtoany.com/subscribe?linkname=TKJ%20Electronics&linkurl=http%3A%2F%2Fblog.tkjelectronics.dk%2Ffeed%2F"><img src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/subscribe_171_16.png" width="171" height="16" alt="Subscribe"></a>
		
<script type="text/javascript">//<![CDATA[
var a2a_config = a2a_config || {};
a2a_config.linkname="TKJ Electronics";
a2a_config.linkurl="http://blog.tkjelectronics.dk/feed/";
a2a_config.onclick=1;
a2a_config.show_title=1;
//]]></script><script type="text/javascript" src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/feed.js"></script>

</div><div id="meta-3" class="widget widget_meta"><h3>Meta</h3>			<ul>
			<li><a href="http://blog.tkjelectronics.dk/wp-login.php?action=register">Register</a></li>			<li><a href="http://blog.tkjelectronics.dk/wp-login.php">Log in</a></li>
			<li><a href="http://blog.tkjelectronics.dk/feed/" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://blog.tkjelectronics.dk/comments/feed/" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
</div></div>
<!-- sidebar south END -->

</div>
<!-- sidebar END -->
	<div class="fixed"></div>
</div>
<!-- content END -->

<!-- footer START -->
<div id="footer">
	<a id="gotop" href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/#" onclick="MGJS.goTop();return false;">Top</a>
	<a id="powered" href="http://wordpress.org/">WordPress</a>
	<div id="copyright">
		Copyright © 2014 TKJ Electronics	</div>
	<div id="themeinfo">
		Theme by <a href="http://www.neoease.com/">NeoEase</a>. Valid <a href="http://validator.w3.org/check?uri=referer">XHTML 1.1</a> and <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3">CSS 3</a>.	</div>
</div>
<!-- footer END -->

</div>
<!-- container END -->
</div><div style="position: static;"><div id="a2afeed_dropdown" class="a2a_menu" onmouseover="a2a.onMouseOver_stay()" style="display:none"><div class="a2a_menu_inside"><div id="a2afeed_title_container" class="a2a_menu_title_container"><input id="a2afeed_title" class="a2a_menu_title"></div><div class="a2afeed_wide a2a_wide"><div class="a2a_tabs a2a_tabs_default"><a href="" id="a2afeed_DEFAULT" class="a2a_tab_selected" style="margin-left:1px" target="_top"><span class="a2a_i_feed">Subscribe</span></a></div><div class="a2a_tabs"><div title="Subscribe via email" id="a2afeed_EMAIL" style="margin-right:1px"><span class="a2a_i_email_bw">Email</span></div></div></div><div class="a2a_clear"></div><div id="a2afeed_find_container" class="a2a_menu_find_container"><input id="a2afeed_find" class="a2a_menu_find" type="text" onclick="a2a.focus_find()" onkeyup="a2a.do_find()" autocomplete="off" onfocus="a2a[&#39;feed&#39;].find_focused=true;a2a.onMouseOver_stay()" title="Instantly find any service"><span id="a2afeed_find_icon" class="a2a_i_find" onclick="a2a.focus_find()"></span></div><div id="a2afeed_cols_container" class="a2a_cols_container"><div class="a2a_col1" id="a2afeed_col1"><a id="a2afeed_feed" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_feed">Feed</span></a><a id="a2afeed_feedly" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_feedly">Feedly</span></a><a id="a2afeed_my_yahoo" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_yahoo">My Yahoo</span></a><a id="a2afeed_my_aol" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_aol">AOL Reader</span></a><a id="a2afeed_bloglines" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_bloglines">Bloglines</span></a><a id="a2afeed_netvibes" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_netvibes">Netvibes</span></a><a id="a2afeed_my_msn" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_my_msn">My MSN</span></a><a id="a2afeed_the_free_dictionary" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_thefreedictionary">The Free Dictionary</span></a><a id="a2afeed_oldreader" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_oldreader">The Old Reader</span></a><a id="a2afeed_protopage_news_feeds" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_protopage">Protopage News Feeds</span></a><a id="a2afeed_itunes" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_itunes">iTunes</span></a><a id="a2afeed_podnova" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_podnova">PodNova</span></a><a id="a2afeed_winksite" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_winksite">WINKsite</span></a><a id="a2afeed_newsisfree" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_newsisfree">NewsIsFree</span></a><a id="a2afeed_klipfolio" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_klipfolio">KlipFolio</span></a><a id="a2afeed_feed_mailer" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_feedmailer">Feed Mailer</span></a><a id="a2afeed_fireant" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_fireant">FireAnt</span></a><a id="a2afeed_feedbucket" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_feedbucket">FeedBucket</span></a><a id="a2afeed_the_free_library" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_thefreelibrary">The Free Library</span></a><a id="a2afeed_daily_rotation" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_dailyrotation">Daily Rotation</span></a><a id="a2afeed_outlook" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_outlook">Outlook</span></a><a id="a2afeed_bitty_browser_preview" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_bitty">Bitty Browser Preview</span></a><a id="a2afeed_rss_2_pdf" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_pdf">RSS 2 PDF</span></a><a id="a2afeed_gritwire" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_default">Gritwire</span></a><a id="a2afeed_feedonsite" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_default">FeedOnSite</span></a><a id="a2afeed_rapidfeeds" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_rapidfeeds">RapidFeeds</span></a><a id="a2afeed_miro" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_miro">Miro</span></a><a id="a2afeed_newsalloy" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_newsalloy">NewsAlloy</span></a><a id="a2afeed_symbaloo_bookmarks" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_symbaloo">Symbaloo Bookmarks</span></a><a id="a2afeed_agregator" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank" style="display: none;"><span class="a2a_i_agregator">Agregator</span></a></div><div id="a2afeed_2_col1" style="display:none"><a id="a2afeed_feedblitz" rel="nofollow" class="a2a_i" href="http://blog.tkjelectronics.dk/" target="_blank"><span class="a2a_i_feedblitz">FeedBlitz</span></a></div><div class="a2a_clear"></div></div><div class="a2afeed_wide a2a_wide"><a href="" id="a2afeed_show_more_less" class="a2a_menu_show_more_less" onmouseover="img=this.firstChild;if(a2a.c.color_arrow_hover==&#39;fff&#39;){if(img.className.indexOf(&#39;_wt&#39;)==-1)img.className+=&#39;_wt&#39;}else img.className=img.className.replace(/_wt/,&#39;&#39;)" onmouseout="img=this.firstChild;if(a2a.c.color_arrow==&#39;fff&#39;){if(img.className.indexOf(&#39;_wt&#39;)==-1)img.className+=&#39;_wt&#39;}else img.className=img.className.replace(/_wt/,&#39;&#39;)" title="Show all"><span class="a2a_i_darr"></span></a></div><div class="a2a_menu_powered_by" id="a2afeed_powered_by" onmouseover="if(this.innerHTML!=this.orig&amp;&amp;!window.opera)this.innerHTML=this.orig;this.style.textAlign=&#39;center&#39;">By <a href="http://www.addtoany.com/" target="_blank" title="Share Buttons">AddToAny</a></div></div></div><div style="height: 1px; width: 1px; position: absolute; z-index: 100000; visibility: hidden;"><iframe id="a2afeed_sm_ifr" height="1" width="1" title="AddToAny Utility Frame" transparency="true" allowtransparency="true" frameborder="0" src="about:blank" style="height: 1px; width: 1px; border: 0px; left: 0px; top: 0px; position: absolute; z-index: 100000; display: none;"></iframe></div></div>
<!-- wrap END -->

<!-- ngg_resource_manager_marker --><!-- Powered by WPtouch: 3.3.4 -->                <script type="text/javascript">
                var sub = document.getElementById('submit');
                document.getElementById('recaptcha-submit-btn-area').appendChild (sub);
                document.getElementById('submit').tabIndex = 6;
                if ( typeof _recaptcha_wordpress_savedcomment != 'undefined') {
                        document.getElementById('comment').value = _recaptcha_wordpress_savedcomment;
                }
                document.getElementById('recaptcha_table').style.direction = 'ltr';
                </script>



<iframe src="./TKJ Electronics » A practical approach to Kalman filter and how to implement it_files/sm11.html" style="height: 0px; width: 0px; visibility: hidden; border: none;">This frame prevents back/forward cache problems in Safari.</iframe></body></html>